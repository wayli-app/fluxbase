# ==============================================================================
# Fluxbase Environment Configuration
# ==============================================================================
# This is an example environment file for Fluxbase deployment.
# Copy this file to .env and update the values for your environment.
#
# SECURITY WARNING: The FLUXBASE_AUTH_JWT_SECRET and other secrets in this file
# are example values for development/testing ONLY. You MUST generate new secure
# values for production deployments.
# ==============================================================================

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------
FLUXBASE_DATABASE_HOST=postgres
FLUXBASE_DATABASE_PORT=5432
FLUXBASE_DATABASE_DATABASE=fluxbase
FLUXBASE_DATABASE_USER=fluxbase
# Optional: Separate admin user for migrations (defaults to user if not set)
# FLUXBASE_DATABASE_ADMIN_USER=fluxbase_admin
FLUXBASE_DATABASE_PASSWORD=fluxbase
FLUXBASE_DATABASE_SSL_MODE=disable

# Connection pool settings (optional - defaults are usually fine)
# FLUXBASE_DATABASE_MAX_CONNECTIONS=25
# FLUXBASE_DATABASE_MIN_CONNECTIONS=5
# FLUXBASE_DATABASE_MAX_CONN_LIFETIME=1h
# FLUXBASE_DATABASE_MAX_CONN_IDLE_TIME=30m
# FLUXBASE_DATABASE_HEALTH_CHECK_PERIOD=1m

# User Migrations (optional - uncomment to enable custom user migrations)
# FLUXBASE_DATABASE_USER_MIGRATIONS_PATH=/migrations/user

# ------------------------------------------------------------------------------
# PostgreSQL Configuration (for postgres service in docker-compose)
# ------------------------------------------------------------------------------
POSTGRES_USER=fluxbase
POSTGRES_PASSWORD=fluxbase
POSTGRES_DB=fluxbase

# ------------------------------------------------------------------------------
# Server Configuration
# ------------------------------------------------------------------------------
FLUXBASE_SERVER_ADDRESS=0.0.0.0:8080

# Timeouts (optional - defaults are usually fine)
# FLUXBASE_SERVER_READ_TIMEOUT=15s
# FLUXBASE_SERVER_WRITE_TIMEOUT=15s
# FLUXBASE_SERVER_IDLE_TIMEOUT=60s
# FLUXBASE_SERVER_BODY_LIMIT=2147483648  # 2GB in bytes

# ------------------------------------------------------------------------------
# JWT Configuration
# ------------------------------------------------------------------------------
# ⚠️  CRITICAL SECURITY WARNING ⚠️
# The FLUXBASE_AUTH_JWT_SECRET below is a randomly generated example for
# development only. For production, you MUST generate a new secret using:
#   openssl rand -base64 32
# Never commit your production JWT secret to version control!
FLUXBASE_AUTH_JWT_SECRET=haEae1GZfKa/lzMHyNFIR5iL0FZFIMMxMN3pb2jqCRc=

# ------------------------------------------------------------------------------
# Security Configuration
# ------------------------------------------------------------------------------
# ⚠️  REQUIRED: Admin Setup Token ⚠️
# This token is REQUIRED to enable the admin dashboard and initial setup.
# If not set, the admin dashboard will be completely disabled.
# Generate a secure token: openssl rand -base64 32
# Store this securely - it's needed only during initial setup.
FLUXBASE_SECURITY_SETUP_TOKEN=your-secret-setup-token-change-in-production
FLUXBASE_AUTH_JWT_EXPIRY=15m
FLUXBASE_AUTH_REFRESH_EXPIRY=168h
FLUXBASE_AUTH_MAGIC_LINK_EXPIRY=15m
FLUXBASE_AUTH_PASSWORD_RESET_EXPIRY=1h

# Authentication settings (optional)
# FLUXBASE_AUTH_PASSWORD_MIN_LENGTH=8
# FLUXBASE_AUTH_BCRYPT_COST=10
# FLUXBASE_AUTH_ENABLE_SIGNUP=false
# FLUXBASE_AUTH_ENABLE_MAGIC_LINK=true
# FLUXBASE_AUTH_ENABLE_RLS=true  # Row Level Security

# ------------------------------------------------------------------------------
# API Keys (for client applications - optional)
# ------------------------------------------------------------------------------
# These keys are used by client applications to authenticate requests.
# Generate using: bash scripts/generate-keys.sh

# Anon Key: JWT token with 'anon' role for client-side anonymous access
# Used in: VITE_FLUXBASE_ANON_KEY, NEXT_PUBLIC_FLUXBASE_ANON_KEY, etc.
# Generate: bash scripts/generate-keys.sh (select option 3 - Anon Key)
# FLUXBASE_AUTH_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYW5vbiIsImVtYWlsIjoiIiwicm9sZSI6ImFub24iLCJzZXNzaW9uX2lkIjoiIiwidG9rZW5fdHlwZSI6ImFjY2VzcyIsImlzX2Fub255bW91cyI6dHJ1ZSwiaXNzIjoiZmx1eGJhc2UiLCJzdWIiOiJhbm9uIiwiaWF0IjoxNzAwMDAwMDAwLCJleHAiOjE3MzE1MzYwMDAsIm5iZiI6MTcwMDAwMDAwMCwianRpIjoiYW5vbiJ9.your-signature-here

# Service Key: For backend services with elevated privileges (bypasses RLS)
# ⚠️  WARNING: Service keys have FULL database access - never expose to clients!
# Generate: bash scripts/generate-keys.sh (select option 2 - Service Key)
# Then store the key hash in database: INSERT INTO auth.service_keys...
# FLUXBASE_AUTH_SERVICE_KEY=sk_test_your-generated-service-key-here

# ------------------------------------------------------------------------------
# Storage Configuration
# ------------------------------------------------------------------------------
# Use local file storage (recommended for development)
FLUXBASE_STORAGE_PROVIDER=local
FLUXBASE_STORAGE_LOCAL_PATH=/app/storage

# For S3-compatible storage (production or MinIO), uncomment below:
# FLUXBASE_STORAGE_PROVIDER=s3
# FLUXBASE_STORAGE_S3_BUCKET=fluxbase
# FLUXBASE_STORAGE_S3_REGION=us-east-1
# FLUXBASE_STORAGE_S3_ENDPOINT=http://minio:9000
# FLUXBASE_STORAGE_S3_ACCESS_KEY=minioadmin
# FLUXBASE_STORAGE_S3_SECRET_KEY=minioadmin

# Upload limits (optional)
# FLUXBASE_STORAGE_MAX_UPLOAD_SIZE=2147483648  # 2GB in bytes

# ------------------------------------------------------------------------------
# MinIO Configuration (for minio service in docker-compose)
# ------------------------------------------------------------------------------
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# ------------------------------------------------------------------------------
# Security Configuration
# ------------------------------------------------------------------------------
# Global rate limiting (optional - disabled by default)
# FLUXBASE_SECURITY_ENABLE_GLOBAL_RATE_LIMIT=false

# Endpoint-specific rate limiting (optional - defaults shown)
# FLUXBASE_SECURITY_ADMIN_SETUP_RATE_LIMIT=5
# FLUXBASE_SECURITY_ADMIN_SETUP_RATE_WINDOW=15m
# FLUXBASE_SECURITY_AUTH_LOGIN_RATE_LIMIT=10
# FLUXBASE_SECURITY_AUTH_LOGIN_RATE_WINDOW=1m
# FLUXBASE_SECURITY_ADMIN_LOGIN_RATE_LIMIT=10
# FLUXBASE_SECURITY_ADMIN_LOGIN_RATE_WINDOW=1m

# ------------------------------------------------------------------------------
# Realtime/WebSocket Configuration
# ------------------------------------------------------------------------------
FLUXBASE_REALTIME_ENABLED=true

# Realtime settings (optional - defaults are usually fine)
# FLUXBASE_REALTIME_MAX_CONNECTIONS=1000
# FLUXBASE_REALTIME_PING_INTERVAL=30s
# FLUXBASE_REALTIME_PONG_TIMEOUT=60s
# FLUXBASE_REALTIME_WRITE_BUFFER_SIZE=1024
# FLUXBASE_REALTIME_READ_BUFFER_SIZE=1024
# FLUXBASE_REALTIME_MESSAGE_SIZE_LIMIT=524288  # 512KB in bytes
# FLUXBASE_REALTIME_CHANNEL_BUFFER_SIZE=100

# ------------------------------------------------------------------------------
# Email Configuration (optional - disabled by default)
# ------------------------------------------------------------------------------
FLUXBASE_EMAIL_ENABLED=false
# FLUXBASE_EMAIL_PROVIDER=smtp
# FLUXBASE_EMAIL_FROM_ADDRESS=noreply@example.com
# FLUXBASE_EMAIL_FROM_NAME=Fluxbase
# FLUXBASE_EMAIL_REPLY_TO_ADDRESS=support@example.com

# SMTP Settings (if using smtp provider)
# FLUXBASE_EMAIL_SMTP_HOST=smtp.example.com
# FLUXBASE_EMAIL_SMTP_PORT=587
# FLUXBASE_EMAIL_SMTP_USERNAME=user
# FLUXBASE_EMAIL_SMTP_PASSWORD=password
# FLUXBASE_EMAIL_SMTP_TLS=true

# SendGrid Settings (if using sendgrid provider)
# FLUXBASE_EMAIL_SENDGRID_API_KEY=your-api-key

# Mailgun Settings (if using mailgun provider)
# FLUXBASE_EMAIL_MAILGUN_API_KEY=your-api-key
# FLUXBASE_EMAIL_MAILGUN_DOMAIN=mg.example.com

# AWS SES Settings (if using ses provider)
# FLUXBASE_EMAIL_SES_ACCESS_KEY=your-access-key
# FLUXBASE_EMAIL_SES_SECRET_KEY=your-secret-key
# FLUXBASE_EMAIL_SES_REGION=us-east-1

# Email Templates (optional - uses built-in templates if not specified)
# FLUXBASE_EMAIL_MAGIC_LINK_TEMPLATE=/path/to/magic_link_template.html
# FLUXBASE_EMAIL_VERIFICATION_TEMPLATE=/path/to/verification_template.html
# FLUXBASE_EMAIL_PASSWORD_RESET_TEMPLATE=/path/to/password_reset_template.html

# ------------------------------------------------------------------------------
# Edge Functions Configuration
# ------------------------------------------------------------------------------
FLUXBASE_FUNCTIONS_ENABLED=true
# FLUXBASE_FUNCTIONS_FUNCTIONS_DIR=./functions
# FLUXBASE_FUNCTIONS_DEFAULT_TIMEOUT=30  # seconds
# FLUXBASE_FUNCTIONS_MAX_TIMEOUT=300  # seconds
# FLUXBASE_FUNCTIONS_DEFAULT_MEMORY_LIMIT=128  # MB
# FLUXBASE_FUNCTIONS_MAX_MEMORY_LIMIT=1024  # MB

# Edge Functions Runtime Environment Variables
# These are automatically available within Deno edge functions via Deno.env.get()
# FLUXBASE_TOKEN=  # Optional service key for functions to call Fluxbase API

# ------------------------------------------------------------------------------
# General Configuration
# ------------------------------------------------------------------------------
FLUXBASE_BASE_URL=http://localhost:8080
FLUXBASE_DEBUG=false

# Advanced Configuration (rarely needed)
# FLUXBASE_DATABASE_RETRY_ATTEMPTS=5  # Database connection retry attempts at startup

# ------------------------------------------------------------------------------
# Production Deployment Notes
# ------------------------------------------------------------------------------
# For production deployments, you should:
# 1. Generate a new FLUXBASE_AUTH_JWT_SECRET using: openssl rand -base64 32
# 2. Use strong, unique passwords for all database and storage credentials
# 3. Enable SSL/TLS for database connections (set FLUXBASE_DATABASE_SSL_MODE=require)
# 4. Use a managed PostgreSQL service or secure your PostgreSQL instance
# 5. Use AWS S3, Google Cloud Storage, or a properly secured MinIO instance
# 6. Consider using a secrets management service (AWS Secrets Manager, etc.)
# 7. Enable and configure rate limiting based on your traffic patterns
# 8. Set up email provider for authentication flows
# 9. Set FLUXBASE_DEBUG=false
# 10. Review and adjust all timeout and limit settings for your use case
# 11. Never commit your production .env file to version control
