# Example Helm values for Standalone PostgreSQL deployment
# This uses a simple StatefulSet with the official PostgreSQL image

# PostgreSQL deployment mode
postgresql:
  mode: standalone # Use simple StatefulSet deployment

  # Database credentials
  auth:
    username: fluxbase
    password: fluxbase # CHANGE THIS IN PRODUCTION
    database: fluxbase
    # For production, create a secret and reference it:
    # existingSecret: fluxbase-db-secret

  # Standalone PostgreSQL configuration
  standalone:
    enabled: true
    image:
      registry: docker.io
      repository: postgres
      tag: "18-alpine"
      pullPolicy: IfNotPresent

    # Persistence settings
    persistence:
      enabled: true
      size: 20Gi # Adjust based on your needs
      storageClass: "" # Use default storage class
      accessModes:
        - ReadWriteOnce

    # Resource limits
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi

# Fluxbase application settings
replicaCount: 3

# Resource allocation
resourcesPreset: "medium"
# Or specify custom resources:
# resources:
#   requests:
#     cpu: 500m
#     memory: 512Mi
#   limits:
#     cpu: 1000m
#     memory: 1Gi

# Storage for user files (when using local storage provider)
persistence:
  enabled: true
  size: 50Gi

# Fluxbase configuration (mirrors fluxbase.yaml.example structure)
fluxbase:
  # Authentication - REQUIRED
  auth:
    jwt_secret: "" # Generate with: openssl rand -base64 32
    jwt_expiry: "15m"
    refresh_expiry: "168h"
    enable_signup: true

  # Security configuration - REQUIRED
  security:
    setup_token: "" # Generate with: openssl rand -base64 32

  # Database connection settings
  database:
    ssl_mode: "disable"
    max_connections: 25
    min_connections: 5

  # Storage configuration
  storage:
    provider: "local"
    local_path: "/data/storage"

  # Server settings
  server:
    address: ":8080"
    read_timeout: "300s"
    write_timeout: "300s"

  # Realtime/WebSocket
  realtime:
    enabled: true

  # Edge Functions
  functions:
    enabled: true

  # Logging
  logging:
    console_level: "info"
    console_format: "json"

# Ingress configuration
ingress:
  enabled: false
  # ingressClassName: nginx
  # hostname: api.example.com
  # tls: true
  # annotations:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod

# Monitoring
metrics:
  enabled: true
  serviceMonitor:
    enabled: false # Set to true if using Prometheus Operator

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 3
  maxReplicas: 10
  targetCPU: 70
  targetMemory: 80

# Security
podSecurityContext:
  enabled: true
  fsGroup: 1001

containerSecurityContext:
  enabled: true
  runAsUser: 1001
  runAsNonRoot: true
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Installation:
# helm install fluxbase ./deploy/helm/fluxbase \
#   -f ./deploy/helm/fluxbase/examples/values-standalone.yaml \
#   --set fluxbase.auth.jwt_secret=$(openssl rand -base64 32) \
#   --set fluxbase.security.setup_token=$(openssl rand -base64 32)
