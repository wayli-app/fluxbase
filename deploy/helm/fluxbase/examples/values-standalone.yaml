# Example Helm values for Standalone PostgreSQL deployment
# This uses a simple StatefulSet with the official PostgreSQL image

# PostgreSQL deployment mode
postgresql:
  mode: standalone # Use simple StatefulSet deployment

  # Database credentials
  auth:
    username: fluxbase
    password: fluxbase # CHANGE THIS IN PRODUCTION
    database: fluxbase
    # For production, create a secret and reference it:
    # existingSecret: fluxbase-db-secret

  # Standalone PostgreSQL configuration
  standalone:
    enabled: true
    image:
      registry: docker.io
      repository: postgres
      tag: "18-alpine"
      pullPolicy: IfNotPresent

    # Persistence settings
    persistence:
      enabled: true
      size: 20Gi # Adjust based on your needs
      storageClass: "" # Use default storage class
      accessModes:
        - ReadWriteOnce

    # Resource limits
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi

# Fluxbase application settings
replicaCount: 3

# Resource allocation
resourcesPreset: "medium"
# Or specify custom resources:
# resources:
#   requests:
#     cpu: 500m
#     memory: 512Mi
#   limits:
#     cpu: 1000m
#     memory: 1Gi

# Storage for user files (when using local storage provider)
persistence:
  enabled: true
  size: 50Gi

# JWT secret - REQUIRED
config:
  jwt:
    secret: "" # Generate with: openssl rand -base64 32

  # Storage configuration
  storage:
    provider: local # or s3
    local:
      basePath: /data/storage

# Ingress configuration
ingress:
  enabled: false
  # ingressClassName: nginx
  # hostname: api.example.com
  # tls: true
  # annotations:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod

# Monitoring
metrics:
  enabled: true
  serviceMonitor:
    enabled: false # Set to true if using Prometheus Operator

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 3
  maxReplicas: 10
  targetCPU: 70
  targetMemory: 80

# Security
podSecurityContext:
  enabled: true
  fsGroup: 1001

containerSecurityContext:
  enabled: true
  runAsUser: 1001
  runAsNonRoot: true
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
# Installation:
# helm install fluxbase ./deploy/helm/fluxbase \
#   -f ./deploy/helm/fluxbase/examples/values-standalone.yaml \
#   --set config.jwt.secret=$(openssl rand -base64 32)
