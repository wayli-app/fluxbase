/**
 * Fluxbase Embedded SDK for Job Runtime
 *
 * This file is auto-generated by bundling the TypeScript SDK.
 * DO NOT EDIT MANUALLY - changes will be overwritten.
 *
 * To regenerate: npm run generate:embedded-sdk (from sdk/ directory)
 * Source: sdk/src/*.ts
 *
 * SDK Version: 0.0.1-rc.48
 * Generated: 2025-12-16T22:41:54.110Z
 *
 * @generated
 */

"use strict";var _FluxbaseSDK=(()=>{var Se=Object.create;var W=Object.defineProperty;var Ee=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var xe=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var Fe=(i,e)=>{for(var t in e)W(i,t,{get:e[t],enumerable:!0})},ve=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Te(e))!Ce.call(i,s)&&s!==t&&W(i,s,{get:()=>e[s],enumerable:!(r=Ee(e,s))||r.enumerable});return i};var _e=(i,e,t)=>(t=i!=null?Se(Ae(i)):{},ve(e||!i||!i.__esModule?W(t,"default",{value:i,enumerable:!0}):t,i)),Ie=i=>ve(W({},"__esModule",{value:!0}),i);var Me={};Fe(Me,{FluxbaseAuth:()=>_,FluxbaseClient:()=>B,FluxbaseFetch:()=>F,FluxbaseJobs:()=>$,FluxbaseStorage:()=>I,QueryBuilder:()=>T,StorageBucket:()=>L,createClient:()=>Pe});var F=class{constructor(e,t={}){this.refreshTokenCallback=null;this.isRefreshing=!1;this.refreshPromise=null;this.anonKey=null;this.baseUrl=e.replace(/\/$/,""),this.defaultHeaders={"Content-Type":"application/json",...t.headers},this.timeout=t.timeout??3e4,this.debug=t.debug??!1}setRefreshTokenCallback(e){this.refreshTokenCallback=e}setAnonKey(e){this.anonKey=e}setAuthToken(e){e?this.defaultHeaders.Authorization=`Bearer ${e}`:this.anonKey?this.defaultHeaders.Authorization=`Bearer ${this.anonKey}`:delete this.defaultHeaders.Authorization}async request(e,t){return this.requestInternal(e,t,!1)}async requestInternal(e,t,r){let s=`${this.baseUrl}${e}`,n={...this.defaultHeaders,...t.headers},a=new AbortController,o=setTimeout(()=>a.abort(),t.timeout??this.timeout);this.debug&&console.log(`[Fluxbase SDK] ${t.method} ${s}`,t.body);try{let l=t.body&&(t.body.constructor?.name==="FormData"||t.body instanceof FormData),c=l?Object.fromEntries(Object.entries(n).filter(([p])=>p.toLowerCase()!=="content-type")):n,u=await fetch(s,{method:t.method,headers:c,body:l?t.body:t.body?JSON.stringify(t.body):void 0,signal:a.signal});clearTimeout(o);let f=u.headers.get("content-type"),h;if(f?.includes("application/json")?h=await u.json():h=await u.text(),this.debug&&console.log("[Fluxbase SDK] Response:",u.status,h),u.status===401&&!r&&!t.skipAutoRefresh&&this.refreshTokenCallback&&await this.handleTokenRefresh())return this.requestInternal(e,t,!0);if(!u.ok){let p=new Error(typeof h=="object"&&h&&"error"in h?String(h.error):u.statusText);throw p.status=u.status,p.details=h,p}return h}catch(l){if(clearTimeout(o),l instanceof Error){if(l.name==="AbortError"){let c=new Error("Request timeout");throw c.status=408,c}throw l}throw new Error("Unknown error occurred")}}async handleTokenRefresh(){if(this.isRefreshing&&this.refreshPromise)return this.refreshPromise;this.isRefreshing=!0,this.refreshPromise=this.executeRefresh();try{return await this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}}async executeRefresh(){if(!this.refreshTokenCallback)return!1;try{return await this.refreshTokenCallback()}catch(e){return this.debug&&console.error("[Fluxbase SDK] Token refresh failed:",e),!1}}async get(e,t={}){return this.request(e,{...t,method:"GET"})}async getWithHeaders(e,t={}){return this.requestWithHeaders(e,{...t,method:"GET"})}async postWithHeaders(e,t,r={}){return this.requestWithHeaders(e,{...r,method:"POST",body:t})}async requestWithHeaders(e,t){return this.requestWithHeadersInternal(e,t,!1)}async requestWithHeadersInternal(e,t,r){let s=`${this.baseUrl}${e}`,n={...this.defaultHeaders,...t.headers},a=new AbortController,o=setTimeout(()=>a.abort(),t.timeout??this.timeout);this.debug&&console.log(`[Fluxbase SDK] ${t.method} ${s}`,t.body);try{let l=t.body&&(t.body.constructor?.name==="FormData"||t.body instanceof FormData),c=l?Object.fromEntries(Object.entries(n).filter(([p])=>p.toLowerCase()!=="content-type")):n,u=await fetch(s,{method:t.method,headers:c,body:l?t.body:t.body?JSON.stringify(t.body):void 0,signal:a.signal});clearTimeout(o);let f=u.headers.get("content-type"),h;if(f?.includes("application/json")?h=await u.json():h=await u.text(),this.debug&&console.log("[Fluxbase SDK] Response:",u.status,h),u.status===401&&!r&&!t.skipAutoRefresh&&this.refreshTokenCallback&&await this.handleTokenRefresh())return this.requestWithHeadersInternal(e,t,!0);if(!u.ok){let p=new Error(typeof h=="object"&&h&&"error"in h?String(h.error):u.statusText);throw p.status=u.status,p.details=h,p}return{data:h,headers:u.headers,status:u.status}}catch(l){if(clearTimeout(o),l instanceof Error){if(l.name==="AbortError"){let c=new Error("Request timeout");throw c.status=408,c}throw l}throw new Error("Unknown error occurred")}}async post(e,t,r={}){return this.request(e,{...r,method:"POST",body:t})}async put(e,t,r={}){return this.request(e,{...r,method:"PUT",body:t})}async patch(e,t,r={}){return this.request(e,{...r,method:"PATCH",body:t})}async delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}async head(e,t={}){let r=`${this.baseUrl}${e}`,s={...this.defaultHeaders,...t.headers};return(await fetch(r,{method:"HEAD",headers:s})).headers}};async function d(i){try{return{data:await i(),error:null}}catch(e){return{data:null,error:e instanceof Error?e:new Error(String(e))}}}async function M(i){try{return await i(),{error:null}}catch(e){return{error:e instanceof Error?e:new Error(String(e))}}}var j="fluxbase.auth.session",$e=10,Oe=1e3,Re=3,ce=class{constructor(){this.store=new Map}get length(){return this.store.size}clear(){this.store.clear()}getItem(e){return this.store.get(e)??null}setItem(e,t){this.store.set(e,t)}removeItem(e){this.store.delete(e)}key(e){return[...this.store.keys()][e]??null}};function Ue(){try{if(typeof localStorage>"u")return!1;let i="__fluxbase_storage_test__";return localStorage.setItem(i,"test"),localStorage.removeItem(i),!0}catch{return!1}}var _=class{constructor(e,t=!0,r=!0){this.session=null;this.refreshTimer=null;this.stateChangeListeners=new Set;this.storage=null;if(this.fetch=e,this.persist=r,this.autoRefresh=t,this.fetch.setRefreshTokenCallback(async()=>!(await this.refreshSession()).error),this.persist&&(Ue()?this.storage=localStorage:this.storage=new ce),this.storage){let s=this.storage.getItem(j);if(s)try{this.session=JSON.parse(s),this.session&&(this.fetch.setAuthToken(this.session.access_token),this.scheduleTokenRefresh())}catch{this.storage.removeItem(j)}}}async getSession(){return{data:{session:this.session},error:null}}async getUser(){return{data:{user:this.session?.user??null},error:null}}getAccessToken(){return this.session?.access_token??null}onAuthStateChange(e){return this.stateChangeListeners.add(e),{data:{subscription:{unsubscribe:()=>{this.stateChangeListeners.delete(e)}}}}}startAutoRefresh(){this.scheduleTokenRefresh()}stopAutoRefresh(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null)}async signIn(e){return d(async()=>{let t=await this.fetch.post("/api/v1/auth/signin",e);if("requires_2fa"in t&&t.requires_2fa)return t;let r=t,s={...r,expires_at:Date.now()+r.expires_in*1e3};return this.setSessionInternal(s),{user:s.user,session:s}})}async signInWithPassword(e){return this.signIn(e)}async signUp(e){return d(async()=>{let t={email:e.email,password:e.password};e.options?.data&&(t.user_metadata=e.options.data);let r=await this.fetch.post("/api/v1/auth/signup",t);if(r.access_token&&r.refresh_token){let s={...r,expires_at:Date.now()+r.expires_in*1e3};return this.setSessionInternal(s),{user:r.user,session:s}}return{user:r.user,session:null}})}async signOut(){return M(async()=>{try{await this.fetch.post("/api/v1/auth/signout")}finally{this.clearSession()}})}async refreshSession(){return d(async()=>{if(!this.session?.refresh_token)throw new Error("No refresh token available");let e=await this.fetch.post("/api/v1/auth/refresh",{refresh_token:this.session.refresh_token},{skipAutoRefresh:!0}),t={...e,user:e.user??this.session.user,expires_at:Date.now()+e.expires_in*1e3};return this.setSessionInternal(t,"TOKEN_REFRESHED"),{user:t.user,session:t}})}async refreshToken(){return this.refreshSession()}async getCurrentUser(){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return{user:await this.fetch.get("/api/v1/auth/user")}})}async updateUser(e){return d(async()=>{if(!this.session)throw new Error("Not authenticated");let t={};e.email&&(t.email=e.email),e.password&&(t.password=e.password),e.data&&(t.user_metadata=e.data),e.nonce&&(t.nonce=e.nonce);let r=await this.fetch.patch("/api/v1/auth/user",t);return this.session&&(this.session.user=r,this.saveSession(),this.emitAuthChange("USER_UPDATED",this.session)),{user:r}})}async setSession(e){return d(async()=>{let t={access_token:e.access_token,refresh_token:e.refresh_token,user:null,expires_in:3600,expires_at:Date.now()+36e5};this.fetch.setAuthToken(e.access_token);let r=await this.fetch.get("/api/v1/auth/user");return t.user=r,this.setSessionInternal(t,"SIGNED_IN"),{user:r,session:t}})}async setup2FA(e){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.post("/api/v1/auth/2fa/setup",e?{issuer:e}:void 0)})}async enable2FA(e){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.post("/api/v1/auth/2fa/enable",{code:e})})}async disable2FA(e){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.post("/api/v1/auth/2fa/disable",{password:e})})}async get2FAStatus(){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.get("/api/v1/auth/2fa/status")})}async verify2FA(e){return d(async()=>{let t=await this.fetch.post("/api/v1/auth/2fa/verify",e);if(t.access_token&&t.refresh_token){let r={user:t.user,access_token:t.access_token,refresh_token:t.refresh_token,expires_in:t.expires_in||3600,expires_at:Date.now()+(t.expires_in||3600)*1e3};this.setSessionInternal(r,"MFA_CHALLENGE_VERIFIED")}return t})}async sendPasswordReset(e){return d(async()=>(await this.fetch.post("/api/v1/auth/password/reset",{email:e}),{user:null,session:null}))}async resetPasswordForEmail(e,t){return this.sendPasswordReset(e)}async verifyResetToken(e){return d(async()=>await this.fetch.post("/api/v1/auth/password/reset/verify",{token:e}))}async resetPassword(e,t){return d(async()=>{let r=await this.fetch.post("/api/v1/auth/password/reset/confirm",{token:e,new_password:t}),s={...r,expires_at:Date.now()+r.expires_in*1e3};return this.setSessionInternal(s,"PASSWORD_RECOVERY"),{user:s.user,session:s}})}async sendMagicLink(e,t){return d(async()=>(await this.fetch.post("/api/v1/auth/magiclink",{email:e,redirect_to:t?.redirect_to}),{user:null,session:null}))}async verifyMagicLink(e){return d(async()=>{let t=await this.fetch.post("/api/v1/auth/magiclink/verify",{token:e}),r={...t,expires_at:Date.now()+t.expires_in*1e3};return this.setSessionInternal(r),{user:r.user,session:r}})}async signInAnonymously(){return d(async()=>{let e=await this.fetch.post("/api/v1/auth/signin/anonymous"),t={...e,expires_at:Date.now()+e.expires_in*1e3};return this.setSessionInternal(t),{user:t.user,session:t}})}async getOAuthProviders(){return d(async()=>await this.fetch.get("/api/v1/auth/oauth/providers"))}async getOAuthUrl(e,t){return d(async()=>{let r=new URLSearchParams;t?.redirect_to&&r.append("redirect_to",t.redirect_to),t?.scopes&&t.scopes.length>0&&r.append("scopes",t.scopes.join(","));let s=r.toString(),n=s?`/api/v1/auth/oauth/${e}/authorize?${s}`:`/api/v1/auth/oauth/${e}/authorize`;return await this.fetch.get(n)})}async exchangeCodeForSession(e){return d(async()=>{let t=await this.fetch.post("/api/v1/auth/oauth/callback",{code:e}),r={...t,expires_at:Date.now()+t.expires_in*1e3};return this.setSessionInternal(r),{user:r.user,session:r}})}async signInWithOAuth(e,t){return d(async()=>{let r=await this.getOAuthUrl(e,t);if(r.error)throw r.error;let s=r.data.url;if(typeof window<"u")window.location.href=s;else throw new Error("signInWithOAuth can only be called in a browser environment");return{provider:e,url:s}})}async signInWithOtp(e){return d(async()=>(await this.fetch.post("/api/v1/auth/otp/signin",e),{user:null,session:null}))}async verifyOtp(e){return d(async()=>{let t=await this.fetch.post("/api/v1/auth/otp/verify",e);if(t.access_token&&t.refresh_token){let r={...t,expires_at:Date.now()+t.expires_in*1e3};return this.setSessionInternal(r),{user:t.user,session:r}}return{user:t.user,session:null}})}async resendOtp(e){return d(async()=>(await this.fetch.post("/api/v1/auth/otp/resend",e),{user:null,session:null}))}async getUserIdentities(){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.get("/api/v1/auth/user/identities")})}async linkIdentity(e){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.post("/api/v1/auth/user/identities",e)})}async unlinkIdentity(e){return M(async()=>{if(!this.session)throw new Error("Not authenticated");await this.fetch.delete(`/api/v1/auth/user/identities/${e.identity.id}`)})}async reauthenticate(){return d(async()=>{if(!this.session)throw new Error("Not authenticated");return await this.fetch.post("/api/v1/auth/reauthenticate")})}async signInWithIdToken(e){return d(async()=>{let t=await this.fetch.post("/api/v1/auth/signin/idtoken",e),r={...t,expires_at:Date.now()+t.expires_in*1e3};return this.setSessionInternal(r),{user:r.user,session:r}})}setSessionInternal(e,t="SIGNED_IN"){this.session=e,this.fetch.setAuthToken(e.access_token),this.saveSession(),this.scheduleTokenRefresh(),this.emitAuthChange(t,e)}clearSession(){this.session=null,this.fetch.setAuthToken(null),this.storage&&this.storage.removeItem(j),this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),this.emitAuthChange("SIGNED_OUT",null)}saveSession(){this.storage&&this.session&&this.storage.setItem(j,JSON.stringify(this.session))}scheduleTokenRefresh(){if(!this.autoRefresh||typeof window>"u"||!this.session?.expires_at)return;this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null);let e=this.session.expires_at,t=Date.now(),r=e-t,s=Math.max(r-$e*1e3,Oe);this.refreshTimer=setTimeout(()=>{this.attemptRefresh()},s)}async attemptRefresh(e=Re){try{let t=await this.refreshSession();if(t.error)throw t.error}catch(t){if(e>0){let r=Math.pow(2,Re-e)*1e3;console.warn(`Token refresh failed, retrying in ${r/1e3}s (${e} attempts remaining)`,t),this.refreshTimer=setTimeout(()=>{this.attemptRefresh(e-1)},r)}else console.error("Token refresh failed after all retries, signing out",t),this.clearSession()}}emitAuthChange(e,t){this.stateChangeListeners.forEach(r=>{try{r(e,t)}catch(s){console.error("Error in auth state change listener:",s)}})}};var he=class{constructor(e,t,r=null,s={}){this.ws=null;this.callbacks=new Map;this.presenceCallbacks=new Map;this.broadcastCallbacks=new Map;this.subscriptionConfig=null;this.subscriptionId=null;this._presenceState={};this.myPresenceKey=null;this.reconnectAttempts=0;this.maxReconnectAttempts=10;this.reconnectDelay=1e3;this.shouldReconnect=!0;this.heartbeatInterval=null;this.pendingAcks=new Map;this.messageIdCounter=0;this.onTokenRefreshNeeded=null;this.isRefreshingToken=!1;this.url=e,this.channelName=t,this.token=r,this.config=s}setTokenRefreshCallback(e){this.onTokenRefreshNeeded=e}on(e,t,r){if(e==="postgres_changes"&&typeof t!="function"){let s=t;this.subscriptionConfig=s;let n=r,a=s.event;this.callbacks.has(a)||this.callbacks.set(a,new Set),this.callbacks.get(a).add(n)}else if(e==="broadcast"&&typeof t!="function"){let s=t,n=r;this.broadcastCallbacks.has(s.event)||this.broadcastCallbacks.set(s.event,new Set),this.broadcastCallbacks.get(s.event).add(n)}else if(e==="presence"&&typeof t!="function"){let s=t,n=r;this.presenceCallbacks.has(s.event)||this.presenceCallbacks.set(s.event,new Set),this.presenceCallbacks.get(s.event).add(n)}else{let s=e,n=t;this.callbacks.has(s)||this.callbacks.set(s,new Set),this.callbacks.get(s).add(n)}return this}off(e,t){let r=this.callbacks.get(e);return r&&r.delete(t),this}subscribe(e,t){if(this.shouldReconnect=!0,this.connect(),e){let r=()=>{this.ws&&this.ws.readyState===WebSocket.OPEN?e("SUBSCRIBED"):this.ws&&this.ws.readyState===WebSocket.CLOSED?e("CHANNEL_ERROR",new Error("Failed to connect")):setTimeout(r,100)};setTimeout(r,100)}return this}async unsubscribe(e){return this.shouldReconnect=!1,new Promise(t=>{if(this.ws){this.sendMessage({type:"unsubscribe",channel:this.channelName,subscription_id:this.subscriptionId||void 0});let r=Date.now(),s=e||5e3,n=()=>{!this.ws||this.ws.readyState===WebSocket.CLOSED?(this.disconnect(),t("ok")):Date.now()-r>s?(this.disconnect(),t("timed out")):setTimeout(n,100)};setTimeout(n,100)}else t("ok")})}async send(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return"error";try{let t=this.config.broadcast?.ack?`msg_${Date.now()}_${++this.messageIdCounter}`:void 0;if(this.ws.send(JSON.stringify({type:"broadcast",channel:this.channelName,event:e.event,payload:e.payload,...t&&{messageId:t}})),this.config.broadcast?.ack&&t){let r=this.config.broadcast.ackTimeout||5e3;return await new Promise((s,n)=>{let a=setTimeout(()=>{this.pendingAcks.delete(t),n(new Error("Acknowledgment timeout"))},r);this.pendingAcks.set(t,{resolve:o=>{clearTimeout(a),this.pendingAcks.delete(t),s(o)},reject:o=>{clearTimeout(a),this.pendingAcks.delete(t),n(o)},timeout:a})}).catch(s=>(console.error("[Fluxbase Realtime] Acknowledgment error:",s),"error"))}return"ok"}catch(t){return console.error("[Fluxbase Realtime] Failed to send broadcast:",t),"error"}}async track(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return"error";try{return this.myPresenceKey||(this.myPresenceKey=this.config.presence?.key||`presence-${Math.random().toString(36).substr(2,9)}`),this.ws.send(JSON.stringify({type:"presence",channel:this.channelName,event:"track",payload:{key:this.myPresenceKey,state:e}})),"ok"}catch(t){return console.error("[Fluxbase Realtime] Failed to track presence:",t),"error"}}async untrack(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return"error";if(!this.myPresenceKey)return"ok";try{return this.ws.send(JSON.stringify({type:"presence",channel:this.channelName,event:"untrack",payload:{key:this.myPresenceKey}})),this.myPresenceKey=null,"ok"}catch(e){return console.error("[Fluxbase Realtime] Failed to untrack presence:",e),"error"}}presenceState(){return{...this._presenceState}}isTokenExpired(){if(!this.token)return!1;try{let e=this.token.split(".");if(e.length!==3||!e[1])return!1;let t=JSON.parse(atob(e[1].replace(/-/g,"+").replace(/_/g,"/")));if(!t.exp)return!1;let r=Math.floor(Date.now()/1e3);return t.exp<=r+10}catch{return!0}}connect(){if(!(this.ws&&this.ws.readyState===WebSocket.OPEN)){if(this.isTokenExpired()&&this.onTokenRefreshNeeded&&!this.isRefreshingToken){this.isRefreshingToken=!0,console.log("[Fluxbase Realtime] Token expired, requesting refresh before connecting"),this.onTokenRefreshNeeded().then(e=>{this.isRefreshingToken=!1,e&&(this.token=e,console.log("[Fluxbase Realtime] Token refreshed, connecting with new token")),this.connectWithToken()}).catch(e=>{this.isRefreshingToken=!1,console.error("[Fluxbase Realtime] Token refresh failed:",e),this.connectWithToken()});return}this.connectWithToken()}}connectWithToken(){let e=new URL(this.url);e.protocol=e.protocol==="https:"?"wss:":"ws:",e.pathname="/realtime",this.token&&e.searchParams.set("token",this.token),this.ws=new WebSocket(e.toString()),this.ws.onopen=()=>{console.log("[Fluxbase Realtime] Connected"),this.reconnectAttempts=0;let t={type:"subscribe",channel:this.channelName};this.subscriptionConfig&&(t.config=this.subscriptionConfig),this.sendMessage(t),this.startHeartbeat()},this.ws.onmessage=t=>{let r;try{r=typeof t.data=="string"?JSON.parse(t.data):t.data}catch(s){console.error("[Fluxbase Realtime] Failed to parse message:",s);return}try{this.handleMessage(r)}catch(s){console.error("[Fluxbase Realtime] Error handling message:",s,r)}},this.ws.onerror=t=>{console.error("[Fluxbase Realtime] WebSocket error:",t)},this.ws.onclose=()=>{console.log("[Fluxbase Realtime] Disconnected"),this.stopHeartbeat(),this.attemptReconnect()}}disconnect(){this.stopHeartbeat(),this.ws&&(this.ws.close(),this.ws=null)}sendMessage(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}handleMessage(e){switch(e.type){case"heartbeat":break;case"broadcast":e.broadcast?this.handleBroadcastMessage(e.broadcast):e.payload&&this.handlePostgresChanges(e.payload);break;case"presence":e.presence&&this.handlePresenceMessage(e.presence);break;case"ack":if(e.messageId&&this.pendingAcks.has(e.messageId)){let t=this.pendingAcks.get(e.messageId);t&&t.resolve(e.status||"ok")}else if(e.payload&&typeof e.payload=="object"&&"type"in e.payload){let t=e.payload;if(t.type==="access_token"&&this.pendingAcks.has("access_token")){let r=this.pendingAcks.get("access_token");r&&(r.resolve("ok"),this.pendingAcks.delete("access_token")),console.log("[Fluxbase Realtime] Token updated successfully")}else t.subscription_id?(this.subscriptionId=t.subscription_id,console.log("[Fluxbase Realtime] Subscription ID received:",this.subscriptionId)):console.log("[Fluxbase Realtime] Acknowledged:",e)}else e.payload&&typeof e.payload=="object"&&"subscription_id"in e.payload?(this.subscriptionId=e.payload.subscription_id,console.log("[Fluxbase Realtime] Subscription ID received:",this.subscriptionId)):console.log("[Fluxbase Realtime] Acknowledged:",e);break;case"error":if(console.error("[Fluxbase Realtime] Error:",e.error),this.pendingAcks.has("access_token")){let t=this.pendingAcks.get("access_token");t&&(t.reject(new Error(e.error||"Token update failed")),this.pendingAcks.delete("access_token"))}break;case"postgres_changes":e.payload&&this.handlePostgresChanges(e.payload);break}}handleBroadcastMessage(e){let t=e.event,r={event:t,payload:e.payload};if(!this.config.broadcast?.self&&e.self)return;let s=this.broadcastCallbacks.get(t);s&&s.forEach(a=>a(r));let n=this.broadcastCallbacks.get("*");n&&n.forEach(a=>a(r))}handlePresenceMessage(e){let t=e.event,r={event:t,key:e.key,newPresences:e.newPresences,leftPresences:e.leftPresences,currentPresences:e.currentPresences||this._presenceState};e.currentPresences&&(this._presenceState=e.currentPresences);let s=this.presenceCallbacks.get(t);s&&s.forEach(n=>n(r))}handlePostgresChanges(e){let t={eventType:e.type||e.eventType,schema:e.schema,table:e.table,commit_timestamp:e.timestamp||e.commit_timestamp||new Date().toISOString(),new:e.new_record||e.new||e.record||{},old:e.old_record||e.old||{},errors:e.errors||null},r=this.callbacks.get(t.eventType);r&&r.forEach(n=>n(t));let s=this.callbacks.get("*");s&&s.forEach(n=>n(t))}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=setInterval(()=>{this.sendMessage({type:"heartbeat"})},3e4)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}updateToken(e){if(this.token=e,!this.ws||this.ws.readyState!==WebSocket.OPEN)return;if(!e){this.disconnect(),this.connect();return}let t={type:"access_token",token:e};try{this.ws.send(JSON.stringify(t));let r=setTimeout(()=>{console.warn("[Fluxbase Realtime] Token update acknowledgment timeout, reconnecting"),this.disconnect(),this.connect()},5e3);this.pendingAcks.set("access_token",{resolve:()=>{clearTimeout(r)},reject:()=>{clearTimeout(r),this.disconnect(),this.connect()},timeout:r})}catch(r){console.error("[Fluxbase Realtime] Failed to send token update:",r),this.disconnect(),this.connect()}}attemptReconnect(){if(!this.shouldReconnect)return;if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("[Fluxbase Realtime] Max reconnect attempts reached");return}this.reconnectAttempts++;let e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`[Fluxbase Realtime] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{this.connect()},e)}},J=class{constructor(e,t=null){this.channels=new Map;this.tokenRefreshCallback=null;this.url=e,this.token=t}setTokenRefreshCallback(e){this.tokenRefreshCallback=e,this.channels.forEach(t=>{t.setTokenRefreshCallback(e)})}channel(e,t){let r=t?JSON.stringify(t):"",s=`${e}:${r}`;if(this.channels.has(s))return this.channels.get(s);let n=new he(this.url,e,this.token,t);return this.tokenRefreshCallback&&n.setTokenRefreshCallback(this.tokenRefreshCallback),this.channels.set(s,n),n}async removeChannel(e){await e.unsubscribe();for(let[t,r]of this.channels.entries())if(r===e)return this.channels.delete(t),"ok";return"error"}removeAllChannels(){this.channels.forEach(e=>e.unsubscribe()),this.channels.clear()}setAuth(e){this.token=e,this.channels.forEach(t=>{t.updateToken(e)})}};var L=class{constructor(e,t){this.fetch=e,this.bucketName=t}async upload(e,t,r){try{let s=new FormData,n;t instanceof ArrayBuffer?n=new Blob([t],{type:r?.contentType}):ArrayBuffer.isView(t)?n=new Blob([t],{type:r?.contentType}):n=t,s.append("file",n),r?.contentType&&s.append("content_type",r.contentType),r?.metadata&&s.append("metadata",JSON.stringify(r.metadata)),r?.cacheControl&&s.append("cache_control",r.cacheControl),r?.upsert!==void 0&&s.append("upsert",String(r.upsert));let a;return r?.onUploadProgress?a=await this.uploadWithProgress(e,s,r.onUploadProgress):a=await this.fetch.request(`/api/v1/storage/${this.bucketName}/${e}`,{method:"POST",body:s,headers:{}}),{data:{id:a.id||a.key||e,path:e,fullPath:`${this.bucketName}/${e}`},error:null}}catch(s){return{data:null,error:s}}}uploadWithProgress(e,t,r){return new Promise((s,n)=>{let a=new XMLHttpRequest,o=`${this.fetch.baseUrl}/api/v1/storage/${this.bucketName}/${e}`;a.upload.addEventListener("progress",c=>{if(c.lengthComputable){let u=Math.round(c.loaded/c.total*100);r({loaded:c.loaded,total:c.total,percentage:u})}}),a.addEventListener("load",()=>{if(a.status>=200&&a.status<300)try{let c=JSON.parse(a.responseText);s(c)}catch{s(a.responseText)}else try{let c=JSON.parse(a.responseText);n(new Error(c.error||a.statusText))}catch{n(new Error(a.statusText))}}),a.addEventListener("error",()=>{n(new Error("Upload failed"))}),a.addEventListener("abort",()=>{n(new Error("Upload aborted"))}),a.open("POST",o);let l=this.fetch.defaultHeaders;for(let[c,u]of Object.entries(l))c.toLowerCase()!=="content-type"&&a.setRequestHeader(c,u);a.send(t)})}async uploadStream(e,t,r,s){try{if(r<=0)return{data:null,error:new Error("size must be a positive number")};let n={...this.fetch.defaultHeaders,"Content-Length":String(r)};s?.contentType&&(n["X-Storage-Content-Type"]=s.contentType),s?.cacheControl&&(n["X-Storage-Cache-Control"]=s.cacheControl),s?.metadata&&Object.keys(s.metadata).length>0&&(n["X-Storage-Metadata"]=JSON.stringify(s.metadata));let a=t;if(s?.onUploadProgress){let c=0,u=s.onUploadProgress,f=r,h=new TransformStream({transform(p,S){c+=p.byteLength;let w=Math.round(c/f*100);u({loaded:c,total:f,percentage:w}),S.enqueue(p)}});a=t.pipeThrough(h)}let o=await fetch(`${this.fetch.baseUrl}/api/v1/storage/${this.bucketName}/stream/${e}`,{method:"POST",headers:n,body:a,signal:s?.signal,duplex:"half"});if(!o.ok){let c=await o.json().catch(()=>({error:o.statusText}));throw new Error(c.error||`Upload failed: ${o.statusText}`)}return{data:{id:(await o.json()).key||e,path:e,fullPath:`${this.bucketName}/${e}`},error:null}}catch(n){return{data:null,error:n}}}async uploadLargeFile(e,t,r){let s={...r,contentType:r?.contentType||t.type||"application/octet-stream"};return this.uploadStream(e,t.stream(),t.size,s)}async download(e,t){try{let r=new AbortController,s;if(t?.signal){if(t.signal.aborted)return{data:null,error:new Error("Download aborted")};t.signal.addEventListener("abort",()=>r.abort(),{once:!0})}let n=t?.timeout??(t?.stream?0:3e4);n>0&&(s=setTimeout(()=>r.abort(),n));try{let a=await fetch(`${this.fetch.baseUrl}/api/v1/storage/${this.bucketName}/${e}`,{headers:this.fetch.defaultHeaders,signal:r.signal});if(s&&clearTimeout(s),!a.ok)throw new Error(`Failed to download file: ${a.statusText}`);if(t?.stream){if(!a.body)throw new Error("Response body is not available for streaming");let l=a.headers.get("content-length"),c=l?parseInt(l,10):null;return{data:{stream:a.body,size:c},error:null}}return{data:await a.blob(),error:null}}catch(a){if(s&&clearTimeout(s),a instanceof Error&&a.name==="AbortError")return t?.signal?.aborted?{data:null,error:new Error("Download aborted")}:{data:null,error:new Error("Download timeout")};throw a}}catch(r){return{data:null,error:r}}}async downloadResumable(e,t){try{let r=t?.chunkSize??5242880,s=t?.maxRetries??3,n=t?.retryDelayMs??1e3,a=t?.chunkTimeout??3e4,o=`${this.fetch.baseUrl}/api/v1/storage/${this.bucketName}/${e}`,l=this.fetch.defaultHeaders;if(t?.signal?.aborted)return{data:null,error:new Error("Download aborted")};let c=await fetch(o,{method:"HEAD",headers:l,signal:t?.signal});if(!c.ok)throw new Error(`Failed to get file info: ${c.statusText}`);let u=c.headers.get("content-length"),f=c.headers.get("accept-ranges"),h=u?parseInt(u,10):null;if(f!=="bytes"){let{data:y,error:m}=await this.download(e,{stream:!0,timeout:0,signal:t?.signal});return m?{data:null,error:m}:{data:y,error:null}}let p=0,S=0,w=h?Math.ceil(h/r):null,U=Date.now(),D=0;return{data:{stream:new ReadableStream({async pull(y){if(t?.signal?.aborted){y.error(new Error("Download aborted"));return}if(h!==null&&p>=h){y.close();return}let m=p,g=h!==null?Math.min(p+r-1,h-1):p+r-1,b=0,E=null;for(;b<=s&&E===null;)try{if(t?.signal?.aborted){y.error(new Error("Download aborted"));return}let P=new AbortController,v=setTimeout(()=>P.abort(),a);t?.signal&&t.signal.addEventListener("abort",()=>P.abort(),{once:!0});let R=await fetch(o,{headers:{...l,Range:`bytes=${m}-${g}`},signal:P.signal});if(clearTimeout(v),!R.ok&&R.status!==206)throw new Error(`Chunk download failed: ${R.statusText}`);let k=await R.arrayBuffer();if(E=new Uint8Array(k),h===null&&E.byteLength<r){p+=E.byteLength,S++,y.enqueue(E),y.close();return}}catch{if(t?.signal?.aborted){y.error(new Error("Download aborted"));return}if(b++,b>s){y.error(new Error(`Failed to download chunk after ${s} retries`));return}let v=n*Math.pow(2,b-1);await new Promise(R=>setTimeout(R,v))}if(E){if(p+=E.byteLength,S++,t?.onProgress){let P=Date.now(),v=(P-U)/1e3,R=v>0?(p-D)/v:0;U=P,D=p,t.onProgress({loaded:p,total:h,percentage:h?Math.round(p/h*100):null,currentChunk:S,totalChunks:w,bytesPerSecond:R})}y.enqueue(E),h!==null&&p>=h&&y.close()}}}),size:h},error:null}}catch(r){return{data:null,error:r}}}async uploadResumable(e,t,r){try{let s=r?.chunkSize??5242880,n=r?.maxRetries??3,a=r?.retryDelayMs??1e3,o=r?.chunkTimeout??6e4,l=t.size,c=Math.ceil(l/s);if(r?.signal?.aborted)return{data:null,error:new Error("Upload aborted")};let u=this.fetch.baseUrl,f=this.fetch.defaultHeaders,h=r?.resumeSessionId,p,S=[];if(h){let m=await fetch(`${u}/api/v1/storage/${this.bucketName}/chunked/${h}/status`,{method:"GET",headers:f,signal:r?.signal});if(!m.ok){let b=await m.json().catch(()=>({}));throw new Error(b.error||`Failed to get session status: ${m.statusText}`)}p=(await m.json()).session,S=p.completedChunks||[]}else{let m=await fetch(`${u}/api/v1/storage/${this.bucketName}/chunked/init`,{method:"POST",headers:{...f,"Content-Type":"application/json"},body:JSON.stringify({path:e,total_size:l,chunk_size:s,content_type:r?.contentType||t.type||"application/octet-stream",metadata:r?.metadata,cache_control:r?.cacheControl}),signal:r?.signal});if(!m.ok){let b=await m.json().catch(()=>({}));throw new Error(b.error||`Failed to initialize upload: ${m.statusText}`)}let g=await m.json();p={sessionId:g.session_id,bucket:g.bucket,path:g.path,totalSize:g.total_size,chunkSize:g.chunk_size,totalChunks:g.total_chunks,completedChunks:g.completed_chunks||[],status:g.status,expiresAt:g.expires_at,createdAt:g.created_at},h=p.sessionId}let w=0;for(let m of S){let g=m*s,b=Math.min(g+s,l);w+=b-g}let U=Date.now(),D=w;for(let m=0;m<c;m++){if(r?.signal?.aborted)return{data:null,error:new Error("Upload aborted")};if(S.includes(m))continue;let g=m*s,b=Math.min(g+s,l),P=await t.slice(g,b).arrayBuffer(),v=0,R=!1;for(;v<=n&&!R;)try{if(r?.signal?.aborted)return{data:null,error:new Error("Upload aborted")};let k=new AbortController,x=setTimeout(()=>k.abort(),o);r?.signal&&r.signal.addEventListener("abort",()=>k.abort(),{once:!0});let C=await fetch(`${u}/api/v1/storage/${this.bucketName}/chunked/${h}/${m}`,{method:"PUT",headers:{...f,"Content-Type":"application/octet-stream","Content-Length":String(P.byteLength)},body:P,signal:k.signal});if(clearTimeout(x),!C.ok){let ke=await C.json().catch(()=>({}));throw new Error(ke.error||`Chunk upload failed: ${C.statusText}`)}R=!0}catch(k){if(r?.signal?.aborted)return{data:null,error:new Error("Upload aborted")};if(v++,v>n)throw new Error(`Failed to upload chunk ${m} after ${n} retries: ${k.message}`);let x=a*Math.pow(2,v-1);await new Promise(C=>setTimeout(C,x))}if(w+=b-g,r?.onProgress){let k=Date.now(),x=(k-U)/1e3,C=x>0?(w-D)/x:0;U=k,D=w,r.onProgress({loaded:w,total:l,percentage:Math.round(w/l*100),currentChunk:m+1,totalChunks:c,bytesPerSecond:C,sessionId:h})}}let q=await fetch(`${u}/api/v1/storage/${this.bucketName}/chunked/${h}/complete`,{method:"POST",headers:f,signal:r?.signal});if(!q.ok){let m=await q.json().catch(()=>({}));throw new Error(m.error||`Failed to complete upload: ${q.statusText}`)}let y=await q.json();return{data:{id:y.id,path:y.path,fullPath:y.full_path},error:null}}catch(s){return{data:null,error:s}}}async abortResumableUpload(e){try{let t=this.fetch.baseUrl,r=this.fetch.defaultHeaders,s=await fetch(`${t}/api/v1/storage/${this.bucketName}/chunked/${e}`,{method:"DELETE",headers:r});if(!s.ok&&s.status!==204){let n=await s.json().catch(()=>({}));throw new Error(n.error||`Failed to abort upload: ${s.statusText}`)}return{error:null}}catch(t){return{error:t}}}async getResumableUploadStatus(e){try{let t=this.fetch.baseUrl,r=this.fetch.defaultHeaders,s=await fetch(`${t}/api/v1/storage/${this.bucketName}/chunked/${e}/status`,{method:"GET",headers:r});if(!s.ok){let a=await s.json().catch(()=>({}));throw new Error(a.error||`Failed to get upload status: ${s.statusText}`)}return{data:(await s.json()).session,error:null}}catch(t){return{data:null,error:t}}}async list(e,t){try{let r=new URLSearchParams,s,n;typeof e=="string"?(s=e,n=t):(n=e,s=n?.prefix),s&&r.set("prefix",s),n?.limit&&r.set("limit",String(n.limit)),n?.offset&&r.set("offset",String(n.offset));let a=r.toString(),o=`/api/v1/storage/${this.bucketName}${a?`?${a}`:""}`;return{data:((await this.fetch.get(o)).files||[]).map(u=>({name:u.key||u.name,id:u.id,bucket_id:u.bucket||this.bucketName,created_at:u.last_modified||u.created_at,updated_at:u.updated_at,last_accessed_at:u.last_accessed_at,metadata:u.metadata})),error:null}}catch(r){return{data:null,error:r}}}async remove(e){try{let t=[];for(let r of e)await this.fetch.delete(`/api/v1/storage/${this.bucketName}/${r}`),t.push({name:r,bucket_id:this.bucketName});return{data:t,error:null}}catch(t){return{data:null,error:t}}}getPublicUrl(e){return{data:{publicUrl:`${this.fetch.baseUrl}/api/v1/storage/${this.bucketName}/${e}`}}}async createSignedUrl(e,t){try{let r=t?.expiresIn||3600;return{data:{signedUrl:(await this.fetch.post(`/api/v1/storage/${this.bucketName}/sign/${e}`,{expires_in:r})).signed_url},error:null}}catch(r){return{data:null,error:r}}}async move(e,t){try{return await this.fetch.post(`/api/v1/storage/${this.bucketName}/move`,{from_path:e,to_path:t}),{data:{message:"Successfully moved"},error:null}}catch(r){return{data:null,error:r}}}async copy(e,t){try{return await this.fetch.post(`/api/v1/storage/${this.bucketName}/copy`,{from_path:e,to_path:t}),{data:{path:t},error:null}}catch(r){return{data:null,error:r}}}async share(e,t){try{return await this.fetch.post(`/api/v1/storage/${this.bucketName}/${e}/share`,{user_id:t.userId,permission:t.permission}),{data:null,error:null}}catch(r){return{data:null,error:r}}}async revokeShare(e,t){try{return await this.fetch.delete(`/api/v1/storage/${this.bucketName}/${e}/share/${t}`),{data:null,error:null}}catch(r){return{data:null,error:r}}}async listShares(e){try{return{data:(await this.fetch.get(`/api/v1/storage/${this.bucketName}/${e}/shares`)).shares||[],error:null}}catch(t){return{data:null,error:t}}}},I=class{constructor(e){this.fetch=e}from(e){return new L(this.fetch,e)}async listBuckets(){try{return{data:(await this.fetch.get("/api/v1/storage/buckets")).buckets||[],error:null}}catch(e){return{data:null,error:e}}}async createBucket(e){try{return await this.fetch.post(`/api/v1/storage/buckets/${e}`),{data:{name:e},error:null}}catch(t){return{data:null,error:t}}}async deleteBucket(e){try{return await this.fetch.delete(`/api/v1/storage/buckets/${e}`),{data:{message:"Successfully deleted"},error:null}}catch(t){return{data:null,error:t}}}async emptyBucket(e){try{let t=this.from(e),{data:r,error:s}=await t.list();if(s)return{data:null,error:s};if(r&&r.length>0){let n=r.map(o=>o.name),{error:a}=await t.remove(n);if(a)return{data:null,error:a}}return{data:{message:"Successfully emptied"},error:null}}catch(t){return{data:null,error:t}}}async updateBucketSettings(e,t){try{return await this.fetch.put(`/api/v1/storage/buckets/${e}`,t),{data:null,error:null}}catch(r){return{data:null,error:r}}}async getBucket(e){try{return{data:await this.fetch.get(`/api/v1/storage/buckets/${e}`),error:null}}catch(t){return{data:null,error:t}}}};var K=class{constructor(e){this.fetch=e}async invoke(e,t){try{let r=t?.method||"POST",s=t?.headers||{},n=t?.body,a=t?.namespace,o=a?`/api/v1/functions/${e}/invoke?namespace=${encodeURIComponent(a)}`:`/api/v1/functions/${e}/invoke`,l;switch(r){case"GET":l=await this.fetch.get(o,{headers:s});break;case"DELETE":l=await this.fetch.delete(o,{headers:s});break;case"PUT":l=await this.fetch.put(o,n,{headers:s});break;case"PATCH":l=await this.fetch.patch(o,n,{headers:s});break;case"POST":default:l=await this.fetch.post(o,n,{headers:s});break}return{data:l,error:null}}catch(r){return{data:null,error:r}}}async list(){try{return{data:await this.fetch.get("/api/v1/functions"),error:null}}catch(e){return{data:null,error:e}}}async get(e){try{return{data:await this.fetch.get(`/api/v1/functions/${e}`),error:null}}catch(t){return{data:null,error:t}}}};var $=class{constructor(e){this.fetch=e}async submit(e,t,r){try{let s={job_name:e,payload:t,priority:r?.priority,namespace:r?.namespace,scheduled:r?.scheduled,on_behalf_of:r?.onBehalfOf};return{data:await this.fetch.post("/api/v1/jobs/submit",s),error:null}}catch(s){return{data:null,error:s}}}async get(e){try{return{data:await this.fetch.get(`/api/v1/jobs/${e}`),error:null}}catch(t){return{data:null,error:t}}}async list(e){try{let t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.namespace&&t.append("namespace",e.namespace),e?.limit&&t.append("limit",e.limit.toString()),e?.offset&&t.append("offset",e.offset.toString()),e?.includeResult&&t.append("include_result","true");let r=t.toString();return{data:await this.fetch.get(`/api/v1/jobs${r?`?${r}`:""}`),error:null}}catch(t){return{data:null,error:t}}}async cancel(e){try{return await this.fetch.post(`/api/v1/jobs/${e}/cancel`,{}),{data:null,error:null}}catch(t){return{data:null,error:t}}}async retry(e){try{return{data:await this.fetch.post(`/api/v1/jobs/${e}/retry`,{}),error:null}}catch(t){return{data:null,error:t}}}};var V=class{constructor(e){this.fetch=e}async list(e){try{let t=e?`?namespace=${encodeURIComponent(e)}`:"";return{data:(await this.fetch.get(`/api/v1/rpc/procedures${t}`)).procedures||[],error:null}}catch(t){return{data:null,error:t}}}async invoke(e,t,r){try{let s=r?.namespace||"default";return{data:await this.fetch.post(`/api/v1/rpc/${encodeURIComponent(s)}/${encodeURIComponent(e)}`,{params:t,async:r?.async}),error:null}}catch(s){return{data:null,error:s}}}async getStatus(e){try{return{data:await this.fetch.get(`/api/v1/rpc/executions/${encodeURIComponent(e)}`),error:null}}catch(t){return{data:null,error:t}}}async getLogs(e,t){try{let r=t!==void 0?`?after=${t}`:"";return{data:(await this.fetch.get(`/api/v1/rpc/executions/${encodeURIComponent(e)}/logs${r}`)).logs||[],error:null}}catch(r){return{data:null,error:r}}}async waitForCompletion(e,t){let r=t?.maxWaitMs||3e4,s=t?.initialIntervalMs||500,n=t?.maxIntervalMs||5e3,a=Date.now(),o=s;for(;Date.now()-a<r;){let{data:l,error:c}=await this.getStatus(e);if(c)return{data:null,error:c};if(!l)return{data:null,error:new Error("Execution not found")};if(t?.onProgress&&t.onProgress(l),l.status==="completed"||l.status==="failed"||l.status==="cancelled"||l.status==="timeout")return{data:l,error:null};await new Promise(u=>setTimeout(u,o)),o=Math.min(o*1.5,n)}return{data:null,error:new Error("Timeout waiting for execution to complete")}}};var de=class{constructor(e){this.fetch=e}async list(){let e=await this.fetch.get("/api/v1/admin/system/settings");return{settings:Array.isArray(e)?e:[]}}async get(e){return await this.fetch.get(`/api/v1/admin/system/settings/${e}`)}async update(e,t){return await this.fetch.put(`/api/v1/admin/system/settings/${e}`,t)}async delete(e){await this.fetch.delete(`/api/v1/admin/system/settings/${e}`)}},pe=class{constructor(e){this.fetch=e}async get(){return await this.fetch.get("/api/v1/admin/app/settings")}async update(e){return await this.fetch.put("/api/v1/admin/app/settings",e)}async reset(){return await this.fetch.post("/api/v1/admin/app/settings/reset",{})}async enableSignup(){return await this.update({authentication:{enable_signup:!0}})}async disableSignup(){return await this.update({authentication:{enable_signup:!1}})}async setPasswordMinLength(e){if(e<8||e>128)throw new Error("Password minimum length must be between 8 and 128 characters");return await this.update({authentication:{password_min_length:e}})}async setFeature(e,t){let r=e==="realtime"?"enable_realtime":e==="storage"?"enable_storage":"enable_functions";return await this.update({features:{[r]:t}})}async setRateLimiting(e){return await this.update({security:{enable_global_rate_limit:e}})}async configureSMTP(e){return await this.update({email:{enabled:!0,provider:"smtp",from_address:e.from_address,from_name:e.from_name,reply_to_address:e.reply_to_address,smtp:{host:e.host,port:e.port,username:e.username,password:e.password,use_tls:e.use_tls}}})}async configureSendGrid(e,t){return await this.update({email:{enabled:!0,provider:"sendgrid",from_address:t?.from_address,from_name:t?.from_name,reply_to_address:t?.reply_to_address,sendgrid:{api_key:e}}})}async configureMailgun(e,t,r){return await this.update({email:{enabled:!0,provider:"mailgun",from_address:r?.from_address,from_name:r?.from_name,reply_to_address:r?.reply_to_address,mailgun:{api_key:e,domain:t,eu_region:r?.eu_region??!1}}})}async configureSES(e,t,r,s){return await this.update({email:{enabled:!0,provider:"ses",from_address:s?.from_address,from_name:s?.from_name,reply_to_address:s?.reply_to_address,ses:{access_key_id:e,secret_access_key:t,region:r}}})}async setEmailEnabled(e){return await this.update({email:{enabled:e}})}async setPasswordComplexity(e){return await this.update({authentication:{password_min_length:e.min_length,password_require_uppercase:e.require_uppercase,password_require_lowercase:e.require_lowercase,password_require_number:e.require_number,password_require_special:e.require_special}})}async setSessionSettings(e,t){return await this.update({authentication:{session_timeout_minutes:e,max_sessions_per_user:t}})}async setEmailVerificationRequired(e){return await this.update({authentication:{require_email_verification:e}})}async getSetting(e){return(await this.fetch.get(`/api/v1/admin/settings/custom/${e}`)).value}async getSettings(e){return(await this.fetch.post("/api/v1/settings/batch",{keys:e})).reduce((r,s)=>(r[s.key]=s.value,r),{})}async setSetting(e,t,r){let s=t!==null&&typeof t=="object"&&!Array.isArray(t)?t:{value:t};try{return await this.fetch.put(`/api/v1/admin/settings/custom/${e}`,{value:s,value_type:r?.value_type||"json",description:r?.description,is_public:r?.is_public,is_secret:r?.is_secret})}catch(n){if(n.status===404||n.message?.includes("not found"))return await this.fetch.post("/api/v1/admin/settings/custom",{key:e,value:s,value_type:r?.value_type||"json",description:r?.description,is_public:r?.is_public??!1,is_secret:r?.is_secret??!1});throw n}}async listSettings(){return await this.fetch.get("/api/v1/admin/settings/custom")}async deleteSetting(e){await this.fetch.delete(`/api/v1/admin/settings/custom/${e}`)}},H=class{constructor(e){this.fetch=e}async list(){let e=await this.fetch.get("/api/v1/admin/email/templates");return{templates:Array.isArray(e)?e:[]}}async get(e){return await this.fetch.get(`/api/v1/admin/email/templates/${e}`)}async update(e,t){return await this.fetch.put(`/api/v1/admin/email/templates/${e}`,t)}async reset(e){return await this.fetch.post(`/api/v1/admin/email/templates/${e}/reset`,{})}async test(e,t){await this.fetch.post(`/api/v1/admin/email/templates/${e}/test`,{recipient_email:t})}},Q=class{constructor(e){this.system=new de(e),this.app=new pe(e)}},z=class{constructor(e){this.fetch=e}async get(e){return(await this.fetch.get(`/api/v1/settings/${encodeURIComponent(e)}`)).value}async getMany(e){return(await this.fetch.post("/api/v1/settings/batch",{keys:e})).reduce((r,s)=>(r[s.key]=s.value,r),{})}};var G=class{constructor(e){this.fetch=e}async createSchema(e){let t={name:e};return await this.fetch.post("/api/v1/admin/ddl/schemas",t)}async listSchemas(){return await this.fetch.get("/api/v1/admin/ddl/schemas")}async createTable(e,t,r){let s={schema:e,name:t,columns:r};return await this.fetch.post("/api/v1/admin/ddl/tables",s)}async listTables(e){let t=e?`?schema=${encodeURIComponent(e)}`:"";return await this.fetch.get(`/api/v1/admin/ddl/tables${t}`)}async deleteTable(e,t){return await this.fetch.delete(`/api/v1/admin/ddl/tables/${encodeURIComponent(e)}/${encodeURIComponent(t)}`)}};var me=class{constructor(e){this.fetch=e}async listProviders(){let e=await this.fetch.get("/api/v1/admin/oauth/providers");return Array.isArray(e)?e:[]}async getProvider(e){return await this.fetch.get(`/api/v1/admin/oauth/providers/${e}`)}async createProvider(e){return await this.fetch.post("/api/v1/admin/oauth/providers",e)}async updateProvider(e,t){return await this.fetch.put(`/api/v1/admin/oauth/providers/${e}`,t)}async deleteProvider(e){return await this.fetch.delete(`/api/v1/admin/oauth/providers/${e}`)}async enableProvider(e){return await this.updateProvider(e,{enabled:!0})}async disableProvider(e){return await this.updateProvider(e,{enabled:!1})}},ge=class{constructor(e){this.fetch=e}async get(){return await this.fetch.get("/api/v1/admin/auth/settings")}async update(e){return await this.fetch.put("/api/v1/admin/auth/settings",e)}},X=class{constructor(e){this.providers=new me(e),this.authSettings=new ge(e)}};var Y=class{constructor(e){this.fetch=e}async impersonateUser(e){return await this.fetch.post("/api/v1/auth/impersonate",e)}async impersonateAnon(e){return await this.fetch.post("/api/v1/auth/impersonate/anon",e)}async impersonateService(e){return await this.fetch.post("/api/v1/auth/impersonate/service",e)}async stop(){return await this.fetch.delete("/api/v1/auth/impersonate")}async getCurrent(){return await this.fetch.get("/api/v1/auth/impersonate")}async listSessions(e={}){let t=new URLSearchParams;e.limit!==void 0&&t.append("limit",String(e.limit)),e.offset!==void 0&&t.append("offset",String(e.offset)),e.admin_user_id&&t.append("admin_user_id",e.admin_user_id),e.target_user_id&&t.append("target_user_id",e.target_user_id),e.impersonation_type&&t.append("impersonation_type",e.impersonation_type),e.is_active!==void 0&&t.append("is_active",String(e.is_active));let r=t.toString(),s=r?`/api/v1/auth/impersonate/sessions?${r}`:"/api/v1/auth/impersonate/sessions";return await this.fetch.get(s)}};var fe=class{constructor(e){this.fetch=e}async create(e){return await this.fetch.post("/api/v1/api-keys",e)}async list(){return await this.fetch.get("/api/v1/api-keys")}async get(e){return await this.fetch.get(`/api/v1/api-keys/${e}`)}async update(e,t){return await this.fetch.patch(`/api/v1/api-keys/${e}`,t)}async revoke(e){return await this.fetch.post(`/api/v1/api-keys/${e}/revoke`,{})}async delete(e){return await this.fetch.delete(`/api/v1/api-keys/${e}`)}},ye=class{constructor(e){this.fetch=e}async create(e){return await this.fetch.post("/api/v1/webhooks",e)}async list(){return await this.fetch.get("/api/v1/webhooks")}async get(e){return await this.fetch.get(`/api/v1/webhooks/${e}`)}async update(e,t){return await this.fetch.patch(`/api/v1/webhooks/${e}`,t)}async delete(e){return await this.fetch.delete(`/api/v1/webhooks/${e}`)}async test(e){return await this.fetch.post(`/api/v1/webhooks/${e}/test`,{})}async listDeliveries(e,t=50){return await this.fetch.get(`/api/v1/webhooks/${e}/deliveries?limit=${t}`)}},be=class{constructor(e){this.fetch=e}async create(e){return await this.fetch.post("/api/v1/admin/invitations",e)}async list(e={}){let t=new URLSearchParams;e.include_accepted!==void 0&&t.append("include_accepted",String(e.include_accepted)),e.include_expired!==void 0&&t.append("include_expired",String(e.include_expired));let r=t.toString(),s=r?`/api/v1/admin/invitations?${r}`:"/api/v1/admin/invitations";return await this.fetch.get(s)}async validate(e){return await this.fetch.get(`/api/v1/invitations/${e}/validate`)}async accept(e,t){return await this.fetch.post(`/api/v1/invitations/${e}/accept`,t)}async revoke(e){return await this.fetch.delete(`/api/v1/admin/invitations/${e}`)}},O=class{constructor(e){this.apiKeys=new fe(e),this.webhooks=new ye(e),this.invitations=new be(e)}};var Z=null;async function N(){if(Z)return!0;try{return Z=await import("esbuild"),!0}catch{return!1}}async function ee(i){if(!await N()||!Z)throw new Error("esbuild is required for bundling. Install it with: npm install esbuild");let t=[...i.external??[]],r={};if(i.importMap)for(let[c,u]of Object.entries(i.importMap))u.startsWith("npm:")||u.startsWith("https://")||u.startsWith("http://")?t.push(c):u.startsWith("/")||u.startsWith("./")||u.startsWith("../")?r[c]=u:t.push(c);let s={name:"deno-external",setup(c){c.onResolve({filter:/^npm:/},u=>({path:u.path,external:!0})),c.onResolve({filter:/^https?:\/\//},u=>({path:u.path,external:!0})),c.onResolve({filter:/^jsr:/},u=>({path:u.path,external:!0}))}},n=i.baseDir||process.cwd?.()||"/",a={stdin:{contents:i.code,loader:"ts",resolveDir:n},absWorkingDir:n,bundle:!0,write:!1,format:"esm",platform:"node",target:"esnext",minify:i.minify??!1,sourcemap:i.sourcemap?"inline":!1,external:t,plugins:[s],treeShaking:!0,resolveExtensions:[".ts",".tsx",".js",".mjs",".json"],conditions:["import","module"]};Object.keys(r).length>0&&(a.alias=r),i.nodePaths&&i.nodePaths.length>0&&(a.nodePaths=i.nodePaths),i.define&&(a.define=i.define);let l=(await Z.build(a)).outputFiles?.[0];if(!l)throw new Error("Bundling failed: no output generated");return{code:l.text,sourceMap:i.sourcemap?l.text:void 0}}var te=class i{constructor(e){this.fetch=e}async create(e){try{return{data:await this.fetch.post("/api/v1/functions",e),error:null}}catch(t){return{data:null,error:t}}}async listNamespaces(){try{return{data:(await this.fetch.get("/api/v1/admin/functions/namespaces")).namespaces||["default"],error:null}}catch(e){return{data:null,error:e}}}async list(e){try{let t=e?`?namespace=${e}`:"";return{data:await this.fetch.get(`/api/v1/functions${t}`),error:null}}catch(t){return{data:null,error:t}}}async get(e){try{return{data:await this.fetch.get(`/api/v1/functions/${e}`),error:null}}catch(t){return{data:null,error:t}}}async update(e,t){try{return{data:await this.fetch.put(`/api/v1/functions/${e}`,t),error:null}}catch(r){return{data:null,error:r}}}async delete(e){try{return await this.fetch.delete(`/api/v1/functions/${e}`),{data:null,error:null}}catch(t){return{data:null,error:t}}}async getExecutions(e,t){try{let r=t?`?limit=${t}`:"";return{data:await this.fetch.get(`/api/v1/functions/${e}/executions${r}`),error:null}}catch(r){return{data:null,error:r}}}async sync(e){try{return{data:await this.fetch.post("/api/v1/admin/functions/sync",e),error:null}}catch(t){return{data:null,error:t}}}async syncWithBundling(e,t){if(!e.functions||e.functions.length===0)return this.sync(e);if(!await N())return{data:null,error:new Error("esbuild is required for client-side bundling. Install it with: npm install esbuild")};try{let s=await Promise.all(e.functions.map(async n=>{if(n.is_pre_bundled)return n;let a=await i.bundleCode({...t,code:n.code,baseDir:n.sourceDir||t?.baseDir,nodePaths:n.nodePaths||t?.nodePaths});return{...n,code:a.code,original_code:n.code,is_pre_bundled:!0}}));return this.sync({...e,functions:s})}catch(s){return{data:null,error:s}}}static async bundleCode(e){return ee(e)}};var re=class{constructor(e){this.localMigrations=new Map;this.fetch=e}register(e){try{if(!e.name||!e.up_sql)return{error:new Error("Migration name and up_sql are required")};let t=`${e.namespace||"default"}:${e.name}`;return this.localMigrations.set(t,e),{error:null}}catch(t){return{error:t}}}async triggerSchemaRefreshWithRestart(){console.log("Triggering schema refresh (server will restart)...");try{let r=await this.fetch.post("/api/v1/admin/schema/refresh",{});console.log("Server restart initiated:",r.message||"Schema refresh in progress")}catch(r){if(!(r.message?.includes("fetch failed")||r.message?.includes("ECONNREFUSED")||r.message?.includes("ECONNRESET")||r.code==="ECONNREFUSED"||r.code==="ECONNRESET"))throw r;console.log("Connection dropped (expected during restart)...")}console.log("Waiting 6 seconds for server to restart..."),await this.sleep(6e3);let e=5,t=1e3;for(let r=1;r<=e;r++)try{await this.fetch.get("/health"),console.log("Server is back online and ready");return}catch{if(r===e)throw new Error(`Server did not come back online after ${e} attempts. Please check server logs and try again.`);let a=t*Math.pow(2,r-1);console.log(`Server not ready yet, retrying in ${a}ms... (attempt ${r}/${e})`),await this.sleep(a)}}sleep(e){return new Promise(t=>setTimeout(t,e))}async sync(e={}){try{let t=new Map;for(let o of this.localMigrations.values()){let l=o.namespace||"default";t.has(l)||t.set(l,[]),t.get(l).push(o)}let r=[],s=[];for(let[o,l]of t)try{let c=await this.fetch.post("/api/v1/admin/migrations/sync",{namespace:o,migrations:l.map(u=>({name:u.name,description:u.description,up_sql:u.up_sql,down_sql:u.down_sql})),options:{update_if_changed:e.update_if_changed??!0,auto_apply:e.auto_apply??!1,dry_run:e.dry_run??!1}});r.push(c)}catch(c){let u=c;if(u.status===422&&u.details)r.push(u.details),s.push(u);else throw c}let n={message:r.map(o=>o.message).join("; "),namespace:Array.from(t.keys()).join(", "),summary:{created:r.reduce((o,l)=>o+l.summary.created,0),updated:r.reduce((o,l)=>o+l.summary.updated,0),unchanged:r.reduce((o,l)=>o+l.summary.unchanged,0),skipped:r.reduce((o,l)=>o+l.summary.skipped,0),applied:r.reduce((o,l)=>o+l.summary.applied,0),errors:r.reduce((o,l)=>o+l.summary.errors,0)},details:{created:r.flatMap(o=>o.details.created),updated:r.flatMap(o=>o.details.updated),unchanged:r.flatMap(o=>o.details.unchanged),skipped:r.flatMap(o=>o.details.skipped),applied:r.flatMap(o=>o.details.applied),errors:r.flatMap(o=>o.details.errors)},dry_run:e.dry_run??!1,warnings:r.flatMap(o=>o.warnings||[])},a=n.summary.applied>0&&n.summary.errors===0;if(!n.dry_run&&a)try{await this.triggerSchemaRefreshWithRestart()}catch(o){console.warn("Schema refresh completed with warnings:",o)}if(s.length>0||n.summary.errors>0){let o=new Error(n.message);return o.syncResult=n,o.details=n.details.errors,{data:n,error:o}}return{data:n,error:null}}catch(t){return{data:null,error:t}}}async create(e){try{return{data:await this.fetch.post("/api/v1/admin/migrations",e),error:null}}catch(t){return{data:null,error:t}}}async list(e="default",t){try{let r=new URLSearchParams({namespace:e});return t&&r.append("status",t),{data:await this.fetch.get(`/api/v1/admin/migrations?${r.toString()}`),error:null}}catch(r){return{data:null,error:r}}}async get(e,t="default"){try{let r=new URLSearchParams({namespace:t});return{data:await this.fetch.get(`/api/v1/admin/migrations/${e}?${r.toString()}`),error:null}}catch(r){return{data:null,error:r}}}async update(e,t,r="default"){try{let s=new URLSearchParams({namespace:r});return{data:await this.fetch.put(`/api/v1/admin/migrations/${e}?${s.toString()}`,t),error:null}}catch(s){return{data:null,error:s}}}async delete(e,t="default"){try{let r=new URLSearchParams({namespace:t});return await this.fetch.delete(`/api/v1/admin/migrations/${e}?${r.toString()}`),{data:null,error:null}}catch(r){return{data:null,error:r}}}async apply(e,t="default"){try{return{data:await this.fetch.post(`/api/v1/admin/migrations/${e}/apply`,{namespace:t}),error:null}}catch(r){return{data:null,error:r}}}async rollback(e,t="default"){try{return{data:await this.fetch.post(`/api/v1/admin/migrations/${e}/rollback`,{namespace:t}),error:null}}catch(r){return{data:null,error:r}}}async applyPending(e="default"){try{return{data:await this.fetch.post("/api/v1/admin/migrations/apply-pending",{namespace:e}),error:null}}catch(t){return{data:null,error:t}}}async getExecutions(e,t="default",r=50){try{let s=new URLSearchParams({namespace:t,limit:r.toString()});return{data:await this.fetch.get(`/api/v1/admin/migrations/${e}/executions?${s.toString()}`),error:null}}catch(s){return{data:null,error:s}}}};var se=class i{constructor(e){this.fetch=e}async create(e){try{return{data:await this.fetch.post("/api/v1/admin/jobs/functions",e),error:null}}catch(t){return{data:null,error:t}}}async listNamespaces(){try{return{data:(await this.fetch.get("/api/v1/admin/jobs/namespaces")).namespaces||["default"],error:null}}catch(e){return{data:null,error:e}}}async list(e){try{let t=e?`?namespace=${e}`:"";return{data:await this.fetch.get(`/api/v1/admin/jobs/functions${t}`),error:null}}catch(t){return{data:null,error:t}}}async get(e,t){try{return{data:await this.fetch.get(`/api/v1/admin/jobs/functions/${e}/${t}`),error:null}}catch(r){return{data:null,error:r}}}async update(e,t,r){try{return{data:await this.fetch.put(`/api/v1/admin/jobs/functions/${e}/${t}`,r),error:null}}catch(s){return{data:null,error:s}}}async delete(e,t){try{return await this.fetch.delete(`/api/v1/admin/jobs/functions/${e}/${t}`),{data:null,error:null}}catch(r){return{data:null,error:r}}}async listJobs(e){try{let t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.namespace&&t.append("namespace",e.namespace),e?.limit&&t.append("limit",e.limit.toString()),e?.offset&&t.append("offset",e.offset.toString()),e?.includeResult&&t.append("include_result","true");let r=t.toString();return{data:await this.fetch.get(`/api/v1/admin/jobs/queue${r?`?${r}`:""}`),error:null}}catch(t){return{data:null,error:t}}}async getJob(e){try{return{data:await this.fetch.get(`/api/v1/admin/jobs/queue/${e}`),error:null}}catch(t){return{data:null,error:t}}}async cancel(e){try{return await this.fetch.post(`/api/v1/admin/jobs/queue/${e}/cancel`,{}),{data:null,error:null}}catch(t){return{data:null,error:t}}}async terminate(e){try{return await this.fetch.post(`/api/v1/admin/jobs/queue/${e}/terminate`,{}),{data:null,error:null}}catch(t){return{data:null,error:t}}}async retry(e){try{return{data:await this.fetch.post(`/api/v1/admin/jobs/queue/${e}/retry`,{}),error:null}}catch(t){return{data:null,error:t}}}async getStats(e){try{let t=e?`?namespace=${e}`:"";return{data:await this.fetch.get(`/api/v1/admin/jobs/stats${t}`),error:null}}catch(t){return{data:null,error:t}}}async listWorkers(){try{return{data:await this.fetch.get("/api/v1/admin/jobs/workers"),error:null}}catch(e){return{data:null,error:e}}}async sync(e){try{let t=typeof e=="string"?{namespace:e}:e;return{data:await this.fetch.post("/api/v1/admin/jobs/sync",{namespace:t.namespace,jobs:t.functions,options:{delete_missing:t.options?.delete_missing??!1,dry_run:t.options?.dry_run??!1}}),error:null}}catch(t){return{data:null,error:t}}}async syncWithBundling(e,t){if(!e.functions||e.functions.length===0)return this.sync(e);if(!await N())return{data:null,error:new Error("esbuild is required for client-side bundling. Install it with: npm install esbuild")};try{let s=await Promise.all(e.functions.map(async n=>{if(n.is_pre_bundled)return n;let a=await i.bundleCode({...t,code:n.code,baseDir:n.sourceDir||t?.baseDir,nodePaths:n.nodePaths||t?.nodePaths});return{...n,code:a.code,original_code:n.code,is_pre_bundled:!0}}));return this.sync({...e,functions:s})}catch(s){return{data:null,error:s}}}static async bundleCode(e){return ee(e)}};var ne=class{constructor(e){this.fetch=e}async listChatbots(e){try{let t=e?`?namespace=${e}`:"";return{data:(await this.fetch.get(`/api/v1/admin/ai/chatbots${t}`)).chatbots||[],error:null}}catch(t){return{data:null,error:t}}}async getChatbot(e){try{return{data:await this.fetch.get(`/api/v1/admin/ai/chatbots/${e}`),error:null}}catch(t){return{data:null,error:t}}}async toggleChatbot(e,t){try{return{data:await this.fetch.put(`/api/v1/admin/ai/chatbots/${e}/toggle`,{enabled:t}),error:null}}catch(r){return{data:null,error:r}}}async deleteChatbot(e){try{return await this.fetch.delete(`/api/v1/admin/ai/chatbots/${e}`),{data:null,error:null}}catch(t){return{data:null,error:t}}}async sync(e){try{return{data:await this.fetch.post("/api/v1/admin/ai/chatbots/sync",{namespace:e?.namespace||"default",chatbots:e?.chatbots,options:{delete_missing:e?.options?.delete_missing??!1,dry_run:e?.options?.dry_run??!1}}),error:null}}catch(t){return{data:null,error:t}}}async listProviders(){try{return{data:(await this.fetch.get("/api/v1/admin/ai/providers")).providers||[],error:null}}catch(e){return{data:null,error:e}}}async getProvider(e){try{return{data:await this.fetch.get(`/api/v1/admin/ai/providers/${e}`),error:null}}catch(t){return{data:null,error:t}}}async createProvider(e){try{return{data:await this.fetch.post("/api/v1/admin/ai/providers",e),error:null}}catch(t){return{data:null,error:t}}}async updateProvider(e,t){try{return{data:await this.fetch.put(`/api/v1/admin/ai/providers/${e}`,t),error:null}}catch(r){return{data:null,error:r}}}async setDefaultProvider(e){try{return{data:await this.fetch.put(`/api/v1/admin/ai/providers/${e}/default`,{}),error:null}}catch(t){return{data:null,error:t}}}async deleteProvider(e){try{return await this.fetch.delete(`/api/v1/admin/ai/providers/${e}`),{data:null,error:null}}catch(t){return{data:null,error:t}}}};var ae=class{constructor(e){this.fetch=e}async sync(e){try{return{data:await this.fetch.post("/api/v1/admin/rpc/sync",{namespace:e?.namespace||"default",procedures:e?.procedures,options:{delete_missing:e?.options?.delete_missing??!1,dry_run:e?.options?.dry_run??!1}}),error:null}}catch(t){return{data:null,error:t}}}async list(e){try{let t=e?`?namespace=${encodeURIComponent(e)}`:"";return{data:(await this.fetch.get(`/api/v1/admin/rpc/procedures${t}`)).procedures||[],error:null}}catch(t){return{data:null,error:t}}}async listNamespaces(){try{return{data:(await this.fetch.get("/api/v1/admin/rpc/namespaces")).namespaces||[],error:null}}catch(e){return{data:null,error:e}}}async get(e,t){try{return{data:await this.fetch.get(`/api/v1/admin/rpc/procedures/${encodeURIComponent(e)}/${encodeURIComponent(t)}`),error:null}}catch(r){return{data:null,error:r}}}async update(e,t,r){try{return{data:await this.fetch.put(`/api/v1/admin/rpc/procedures/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,r),error:null}}catch(s){return{data:null,error:s}}}async toggle(e,t,r){return this.update(e,t,{enabled:r})}async delete(e,t){try{return await this.fetch.delete(`/api/v1/admin/rpc/procedures/${encodeURIComponent(e)}/${encodeURIComponent(t)}`),{data:null,error:null}}catch(r){return{data:null,error:r}}}async listExecutions(e){try{let t=new URLSearchParams;e?.namespace&&t.set("namespace",e.namespace),e?.procedure&&t.set("procedure_name",e.procedure),e?.status&&t.set("status",e.status),e?.user_id&&t.set("user_id",e.user_id),e?.limit&&t.set("limit",e.limit.toString()),e?.offset&&t.set("offset",e.offset.toString());let r=t.toString(),s=r?`/api/v1/admin/rpc/executions?${r}`:"/api/v1/admin/rpc/executions";return{data:(await this.fetch.get(s)).executions||[],error:null}}catch(t){return{data:null,error:t}}}async getExecution(e){try{return{data:await this.fetch.get(`/api/v1/admin/rpc/executions/${encodeURIComponent(e)}`),error:null}}catch(t){return{data:null,error:t}}}async getExecutionLogs(e,t){try{let r=t!==void 0?`?after=${t}`:"";return{data:(await this.fetch.get(`/api/v1/admin/rpc/executions/${encodeURIComponent(e)}/logs${r}`)).logs||[],error:null}}catch(r){return{data:null,error:r}}}async cancelExecution(e){try{return{data:await this.fetch.post(`/api/v1/admin/rpc/executions/${encodeURIComponent(e)}/cancel`,{}),error:null}}catch(t){return{data:null,error:t}}}};var oe=class{constructor(e){this.adminToken=null;this.fetch=e,this.settings=new Q(e),this.ddl=new G(e),this.oauth=new X(e),this.impersonation=new Y(e),this.management=new O(e),this.emailTemplates=new H(e),this.functions=new te(e),this.jobs=new se(e),this.migrations=new re(e),this.ai=new ne(e),this.rpc=new ae(e)}setToken(e){this.adminToken=e,this.fetch.setAuthToken(e)}getToken(){return this.adminToken}clearToken(){this.adminToken=null,this.fetch.setAuthToken(null)}async getSetupStatus(){return d(async()=>await this.fetch.get("/api/v1/admin/setup/status"))}async setup(e){return d(async()=>{let t=await this.fetch.post("/api/v1/admin/setup",e);return this.setToken(t.access_token),t})}async login(e){return d(async()=>{let t=await this.fetch.post("/api/v1/admin/login",e);return this.setToken(t.access_token),t})}async refreshToken(e){return d(async()=>{let t=await this.fetch.post("/api/v1/admin/refresh",e);return this.setToken(t.access_token),t})}async logout(){return M(async()=>{await this.fetch.post("/api/v1/admin/logout",{}),this.clearToken()})}async me(){return d(async()=>await this.fetch.get("/api/v1/admin/me"))}async listUsers(e={}){return d(async()=>{let t=new URLSearchParams;e.exclude_admins!==void 0&&t.append("exclude_admins",String(e.exclude_admins)),e.search&&t.append("search",e.search),e.limit!==void 0&&t.append("limit",String(e.limit)),e.type&&t.append("type",e.type);let r=t.toString(),s=r?`/api/v1/admin/users?${r}`:"/api/v1/admin/users";return await this.fetch.get(s)})}async getUserById(e,t="app"){return d(async()=>{let r=`/api/v1/admin/users/${e}?type=${t}`;return await this.fetch.get(r)})}async inviteUser(e,t="app"){return d(async()=>{let r=`/api/v1/admin/users/invite?type=${t}`;return await this.fetch.post(r,e)})}async deleteUser(e,t="app"){return d(async()=>{let r=`/api/v1/admin/users/${e}?type=${t}`;return await this.fetch.delete(r)})}async updateUserRole(e,t,r="app"){return d(async()=>{let s=`/api/v1/admin/users/${e}/role?type=${r}`;return await this.fetch.patch(s,{role:t})})}async resetUserPassword(e,t="app"){return d(async()=>{let r=`/api/v1/admin/users/${e}/reset-password?type=${t}`;return await this.fetch.post(r,{})})}};var we=class{constructor(e){this.ws=null;this.reconnectCount=0;this.pendingStartResolve=null;this.pendingStartReject=null;this.accumulatedContent=new Map;this.options={reconnectAttempts:3,reconnectDelay:1e3,...e}}async connect(){return new Promise((e,t)=>{let r=this.buildWsUrl();try{this.ws=new WebSocket(r),this.ws.onopen=()=>{this.reconnectCount=0,this.emitEvent({type:"connected"}),e()},this.ws.onmessage=s=>{this.handleMessage(s.data)},this.ws.onclose=s=>{this.emitEvent({type:"disconnected"}),this.handleClose(s)},this.ws.onerror=()=>{t(new Error("WebSocket connection failed"))}}catch(s){t(s)}})}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws?.readyState===WebSocket.OPEN}async startChat(e,t,r,s){return new Promise((n,a)=>{if(!this.isConnected()){a(new Error("Not connected to AI chat"));return}this.pendingStartResolve=n,this.pendingStartReject=a;let o={type:"start_chat",chatbot:e,namespace:t||"default",conversation_id:r,impersonate_user_id:s};this.ws.send(JSON.stringify(o))})}sendMessage(e,t){if(!this.isConnected())throw new Error("Not connected to AI chat");this.accumulatedContent.set(e,"");let r={type:"message",conversation_id:e,content:t};this.ws.send(JSON.stringify(r))}cancel(e){if(!this.isConnected())throw new Error("Not connected to AI chat");let t={type:"cancel",conversation_id:e};this.ws.send(JSON.stringify(t))}getAccumulatedContent(e){return this.accumulatedContent.get(e)||""}buildWsUrl(){let e=this.options.wsUrl||"/ai/ws";if(this.options.token){let t=e.includes("?")?"&":"?";e=`${e}${t}token=${encodeURIComponent(this.options.token)}`}return e}handleMessage(e){try{let t=JSON.parse(e),r=this.serverMessageToEvent(t);switch(t.type){case"chat_started":this.pendingStartResolve&&t.conversation_id&&(this.pendingStartResolve(t.conversation_id),this.pendingStartResolve=null,this.pendingStartReject=null);break;case"content":if(t.conversation_id&&t.delta){let s=this.accumulatedContent.get(t.conversation_id)||"";this.accumulatedContent.set(t.conversation_id,s+t.delta),this.options.onContent?.(t.delta,t.conversation_id)}break;case"progress":t.step&&t.message&&t.conversation_id&&this.options.onProgress?.(t.step,t.message,t.conversation_id);break;case"query_result":t.conversation_id&&this.options.onQueryResult?.(t.query||"",t.summary||"",t.row_count||0,t.data||[],t.conversation_id);break;case"done":t.conversation_id&&this.options.onDone?.(t.usage,t.conversation_id);break;case"error":this.pendingStartReject&&(this.pendingStartReject(new Error(t.error||"Unknown error")),this.pendingStartResolve=null,this.pendingStartReject=null),this.options.onError?.(t.error||"Unknown error",t.code,t.conversation_id);break}this.emitEvent(r)}catch(t){console.error("Failed to parse AI chat message:",t)}}serverMessageToEvent(e){return{type:e.type,conversationId:e.conversation_id,chatbot:e.chatbot,step:e.step,message:e.message,delta:e.delta,query:e.query,summary:e.summary,rowCount:e.row_count,data:e.data,usage:e.usage,error:e.error,code:e.code}}emitEvent(e){this.options.onEvent?.(e)}handleClose(e){this.options.reconnectAttempts&&this.reconnectCount<this.options.reconnectAttempts&&(this.reconnectCount++,setTimeout(()=>{this.connect().catch(()=>{})},this.options.reconnectDelay))}},ie=class{constructor(e,t){this.fetch=e,this.wsBaseUrl=t}async listChatbots(){try{return{data:(await this.fetch.get("/api/v1/ai/chatbots")).chatbots||[],error:null}}catch(e){return{data:null,error:e}}}async getChatbot(e){try{return{data:await this.fetch.get(`/api/v1/ai/chatbots/${e}`),error:null}}catch(t){return{data:null,error:t}}}createChat(e){return new we({...e,wsUrl:`${this.wsBaseUrl}/ai/ws`})}async listConversations(e){try{let t=new URLSearchParams;e?.chatbot&&t.set("chatbot",e.chatbot),e?.namespace&&t.set("namespace",e.namespace),e?.limit!==void 0&&t.set("limit",String(e.limit)),e?.offset!==void 0&&t.set("offset",String(e.offset));let r=t.toString(),s=`/api/v1/ai/conversations${r?`?${r}`:""}`;return{data:await this.fetch.get(s),error:null}}catch(t){return{data:null,error:t}}}async getConversation(e){try{return{data:await this.fetch.get(`/api/v1/ai/conversations/${e}`),error:null}}catch(t){return{data:null,error:t}}}async deleteConversation(e){try{return await this.fetch.delete(`/api/v1/ai/conversations/${e}`),{error:null}}catch(t){return{error:t}}}async updateConversation(e,t){try{return{data:await this.fetch.patch(`/api/v1/ai/conversations/${e}`,t),error:null}}catch(r){return{data:null,error:r}}}};var ue=class{constructor(e){this.fetch=e}async embed(e){try{return{data:await this.fetch.request("/api/v1/vector/embed",{method:"POST",body:e}),error:null}}catch(t){return{data:null,error:t}}}async search(e){try{return{data:await this.fetch.request("/api/v1/vector/search",{method:"POST",body:{table:e.table,column:e.column,query:e.query,vector:e.vector,metric:e.metric||"cosine",match_threshold:e.match_threshold,match_count:e.match_count,select:e.select,filters:e.filters}}),error:null}}catch(t){return{data:null,error:t}}}};var T=class{constructor(e,t,r){this.selectQuery="*";this.filters=[];this.orFilters=[];this.andFilters=[];this.betweenFilters=[];this.orderBys=[];this.singleRow=!1;this.maybeSingleRow=!1;this.operationType="select";this.headOnly=!1;this.isCountAggregation=!1;this.fetch=e,this.table=t,this.schema=r}buildTablePath(){return this.schema?`/api/v1/tables/${this.schema}/${this.table}`:`/api/v1/tables/${this.table}`}select(e="*",t){return this.selectQuery=e,t?.count&&(this.countType=t.count),t?.head&&(this.headOnly=!0),this}insert(e){return this.operationType="insert",this.insertData=e,this}async upsert(e,t){let r=(Array.isArray(e),e),s=[];t?.ignoreDuplicates?s.push("resolution=ignore-duplicates"):s.push("resolution=merge-duplicates"),t?.defaultToNull&&s.push("missing=default");let n={Prefer:s.join(",")},a=this.buildTablePath();return t?.onConflict&&(a+=`?on_conflict=${encodeURIComponent(t.onConflict)}`),{data:await this.fetch.post(a,r,{headers:n}),error:null,count:Array.isArray(e)?e.length:1,status:201,statusText:"Created"}}update(e){return this.operationType="update",this.updateData=e,this}delete(){return this.operationType="delete",this}eq(e,t){return this.filters.push({column:e,operator:"eq",value:t}),this}neq(e,t){return this.filters.push({column:e,operator:"neq",value:t}),this}gt(e,t){return this.filters.push({column:e,operator:"gt",value:t}),this}gte(e,t){return this.filters.push({column:e,operator:"gte",value:t}),this}lt(e,t){return this.filters.push({column:e,operator:"lt",value:t}),this}lte(e,t){return this.filters.push({column:e,operator:"lte",value:t}),this}like(e,t){return this.filters.push({column:e,operator:"like",value:t}),this}ilike(e,t){return this.filters.push({column:e,operator:"ilike",value:t}),this}is(e,t){return this.filters.push({column:e,operator:"is",value:t}),this}in(e,t){return this.filters.push({column:e,operator:"in",value:t}),this}contains(e,t){return this.filters.push({column:e,operator:"cs",value:t}),this}textSearch(e,t){return this.filters.push({column:e,operator:"fts",value:t}),this}not(e,t,r){return this.filters.push({column:e,operator:"not",value:`${t}.${this.formatValue(r)}`}),this}or(e){return this.orFilters.push(e),this}and(e){return this.andFilters.push(e),this}match(e){for(let[t,r]of Object.entries(e))this.eq(t,r);return this}filter(e,t,r){if(t==="between"||t==="not.between"){let[s,n]=this.validateBetweenValue(r,t);return this.betweenFilters.push({column:e,min:s,max:n,negated:t==="not.between"}),this}return this.filters.push({column:e,operator:t,value:r}),this}containedBy(e,t){return this.filters.push({column:e,operator:"cd",value:t}),this}overlaps(e,t){return this.filters.push({column:e,operator:"ov",value:t}),this}between(e,t,r){return this.filter(e,"between",[t,r])}notBetween(e,t,r){return this.filter(e,"not.between",[t,r])}intersects(e,t){return this.filters.push({column:e,operator:"st_intersects",value:t}),this}stContains(e,t){return this.filters.push({column:e,operator:"st_contains",value:t}),this}within(e,t){return this.filters.push({column:e,operator:"st_within",value:t}),this}touches(e,t){return this.filters.push({column:e,operator:"st_touches",value:t}),this}crosses(e,t){return this.filters.push({column:e,operator:"st_crosses",value:t}),this}stOverlaps(e,t){return this.filters.push({column:e,operator:"st_overlaps",value:t}),this}order(e,t){return this.orderBys.push({column:e,direction:t?.ascending===!1?"desc":"asc",nulls:t?.nullsFirst?"first":"last"}),this}orderByVector(e,t,r="cosine",s){let n={l2:"vec_l2",cosine:"vec_cos",inner_product:"vec_ip"};return this.orderBys.push({column:e,direction:s?.ascending===!1?"desc":"asc",vectorOp:n[r],vectorValue:t}),this}vectorSearch(e,t,r="cosine"){let s={l2:"vec_l2",cosine:"vec_cos",inner_product:"vec_ip"};return this.filters.push({column:e,operator:s[r],value:t}),this.orderByVector(e,t,r,{ascending:!0}),this}limit(e){return this.limitValue=e,this}offset(e){return this.offsetValue=e,this}single(){return this.singleRow=!0,this.limitValue=1,this}maybeSingle(){return this.maybeSingleRow=!0,this.limitValue=1,this}range(e,t){return this.offsetValue=e,this.limitValue=t-e+1,this}groupBy(e){return this.groupByColumns=Array.isArray(e)?e:[e],this}count(e="*"){return this.selectQuery=`count(${e})`,this.isCountAggregation=!0,this}sum(e){return this.selectQuery=`sum(${e})`,this}avg(e){return this.selectQuery=`avg(${e})`,this}min(e){return this.selectQuery=`min(${e})`,this}max(e){return this.selectQuery=`max(${e})`,this}async insertMany(e){return this.insert(e).execute()}async updateMany(e){return this.update(e).execute()}async deleteMany(){return this.delete().execute()}async execute(){try{if(this.operationType==="insert"){if(!this.insertData)throw new Error("Insert data is required for insert operation");let s=Array.isArray(this.insertData)?this.insertData:this.insertData;return{data:await this.fetch.post(this.buildTablePath(),s),error:null,count:Array.isArray(this.insertData)?this.insertData.length:1,status:201,statusText:"Created"}}if(this.operationType==="update"){if(!this.updateData)throw new Error("Update data is required for update operation");let s=this.buildQueryString(),n=`${this.buildTablePath()}${s}`;return{data:await this.fetch.patch(n,this.updateData),error:null,count:null,status:200,statusText:"OK"}}if(this.operationType==="delete"){let s=this.buildQueryString(),n=`${this.buildTablePath()}${s}`;return await this.fetch.delete(n),{data:null,error:null,count:null,status:204,statusText:"No Content"}}if(this.shouldUsePostQuery())return this.executePostQuery();let e=this.buildQueryString(),t=`${this.buildTablePath()}${e}`;if(this.countType){let s=await this.fetch.getWithHeaders(t),n=this.parseContentRangeCount(s.headers),a=s.data;return this.headOnly?{data:null,error:null,count:n,status:s.status,statusText:"OK"}:this.singleRow?Array.isArray(a)&&a.length===0?{data:null,error:{message:"No rows found",code:"PGRST116"},count:n??0,status:404,statusText:"Not Found"}:{data:Array.isArray(a)?a[0]:a,error:null,count:n??1,status:200,statusText:"OK"}:this.maybeSingleRow?Array.isArray(a)&&a.length===0?{data:null,error:null,count:n??0,status:200,statusText:"OK"}:{data:Array.isArray(a)?a[0]:a,error:null,count:n??1,status:200,statusText:"OK"}:{data:a,error:null,count:n??(Array.isArray(a)?a.length:null),status:200,statusText:"OK"}}let r=await this.fetch.get(t);if(this.isCountAggregation&&!this.groupByColumns){if(Array.isArray(r)&&r.length===1){let s=r[0];if(s&&typeof s.count=="number")return{data:r,error:null,count:s.count,status:200,statusText:"OK"}}if(Array.isArray(r)&&r.length===0)return{data:r,error:null,count:0,status:200,statusText:"OK"}}return this.singleRow?Array.isArray(r)&&r.length===0?{data:null,error:{message:"No rows found",code:"PGRST116"},count:0,status:404,statusText:"Not Found"}:{data:Array.isArray(r)?r[0]:r,error:null,count:1,status:200,statusText:"OK"}:this.maybeSingleRow?Array.isArray(r)&&r.length===0?{data:null,error:null,count:0,status:200,statusText:"OK"}:{data:Array.isArray(r)?r[0]:r,error:null,count:1,status:200,statusText:"OK"}:{data:r,error:null,count:Array.isArray(r)?r.length:null,status:200,statusText:"OK"}}catch(e){return{data:null,error:{message:e.message,code:"PGRST000"},count:null,status:500,statusText:"Internal Server Error"}}}async throwOnError(){let e=await this.execute();if(e.error){let t=new Error(e.error.message);throw e.error.code&&(t.code=e.error.code),t}return e.data}then(e,t){return this.execute().then(e,t)}buildQueryString(){let e=new URLSearchParams;this.selectQuery&&this.selectQuery!=="*"&&e.append("select",this.selectQuery);for(let s of this.filters)e.append(s.column,`${s.operator}.${this.formatValue(s.value)}`);let t=[];for(let s of this.orFilters)t.push(`or(${s})`);for(let s of this.betweenFilters){let n=this.formatValue(s.min),a=this.formatValue(s.max);s.negated?t.push(`or(${s.column}.lt.${n},${s.column}.gt.${a})`):(e.append(s.column,`gte.${n}`),e.append(s.column,`lte.${a}`))}if(t.length===1){let n=t[0].replace(/^or\(/,"(");e.append("or",n)}else t.length>1&&e.append("and",`(${t.join(",")})`);for(let s of this.andFilters)e.append("and",`(${s})`);if(this.groupByColumns&&this.groupByColumns.length>0&&e.append("group_by",this.groupByColumns.join(",")),this.orderBys.length>0){let s=this.orderBys.map(n=>{if(n.vectorOp&&n.vectorValue){let a=`[${n.vectorValue.join(",")}]`;return`${n.column}.${n.vectorOp}.${a}.${n.direction}`}return`${n.column}.${n.direction}${n.nulls?`.nulls${n.nulls}`:""}`}).join(",");e.append("order",s)}this.limitValue!==void 0&&e.append("limit",String(this.limitValue)),this.offsetValue!==void 0&&e.append("offset",String(this.offsetValue)),this.countType&&e.append("count",this.countType);let r=e.toString();return r?`?${r}`:""}formatValue(e){return e===null?"null":typeof e=="boolean"?e?"true":"false":Array.isArray(e)?`(${e.map(t=>this.formatValue(t)).join(",")})`:typeof e=="object"?JSON.stringify(e):String(e)}validateBetweenValue(e,t){if(!Array.isArray(e))throw new Error(`Invalid value for '${t}' operator: expected array of [min, max], got ${typeof e}`);if(e.length!==2)throw new Error(`Invalid value for '${t}' operator: expected array with exactly 2 elements [min, max], got ${e.length} elements`);let[r,s]=e;if(r==null)throw new Error(`Invalid value for '${t}' operator: min value cannot be null or undefined`);if(s==null)throw new Error(`Invalid value for '${t}' operator: max value cannot be null or undefined`);return[r,s]}parseContentRangeCount(e){let t=e.get("Content-Range");if(!t)return null;let r=t.match(/\/(\d+)$/);return r&&r[1]?parseInt(r[1],10):null}shouldUsePostQuery(){return this.buildQueryString().length>4096}async executePostQuery(){let e=this.buildQueryBody(),t=`${this.buildTablePath()}/query`;if(this.countType){let s=await this.fetch.postWithHeaders(t,e),n=this.parseContentRangeCount(s.headers),a=s.data;return this.headOnly?{data:null,error:null,count:n,status:s.status,statusText:"OK"}:this.singleRow?Array.isArray(a)&&a.length===0?{data:null,error:{message:"No rows found",code:"PGRST116"},count:n??0,status:404,statusText:"Not Found"}:{data:Array.isArray(a)?a[0]:a,error:null,count:n??1,status:200,statusText:"OK"}:this.maybeSingleRow?Array.isArray(a)&&a.length===0?{data:null,error:null,count:n??0,status:200,statusText:"OK"}:{data:Array.isArray(a)?a[0]:a,error:null,count:n??1,status:200,statusText:"OK"}:{data:a,error:null,count:n??(Array.isArray(a)?a.length:null),status:200,statusText:"OK"}}let r=await this.fetch.post(t,e);return this.singleRow?Array.isArray(r)&&r.length===0?{data:null,error:{message:"No rows found",code:"PGRST116"},count:0,status:404,statusText:"Not Found"}:{data:Array.isArray(r)?r[0]:r,error:null,count:1,status:200,statusText:"OK"}:this.maybeSingleRow?Array.isArray(r)&&r.length===0?{data:null,error:null,count:0,status:200,statusText:"OK"}:{data:Array.isArray(r)?r[0]:r,error:null,count:1,status:200,statusText:"OK"}:{data:r,error:null,count:Array.isArray(r)?r.length:null,status:200,statusText:"OK"}}buildQueryBody(){return{select:this.selectQuery!=="*"?this.selectQuery:void 0,filters:this.filters.map(e=>({column:e.column,operator:e.operator,value:e.value})),orFilters:this.orFilters,andFilters:this.andFilters,betweenFilters:this.betweenFilters.map(e=>({column:e.column,min:e.min,max:e.max,negated:e.negated})),order:this.orderBys.map(e=>({column:e.column,direction:e.direction,nulls:e.nulls,vectorOp:e.vectorOp,vectorValue:e.vectorValue})),limit:this.limitValue,offset:this.offsetValue,count:this.countType,groupBy:this.groupByColumns}}};var le=class{constructor(e,t){this.fetch=e;this.schemaName=t}from(e){return new T(this.fetch,e,this.schemaName)}};var B=class{constructor(e,t,r){this.fluxbaseUrl=e;this.fluxbaseKey=t;let s={apikey:t,Authorization:`Bearer ${t}`,...r?.headers};this.fetch=new F(e,{headers:s,timeout:r?.timeout,debug:r?.debug}),this.fetch.setAnonKey(t),this.auth=new _(this.fetch,r?.auth?.autoRefresh??!0,r?.auth?.persist??!0),r?.auth?.token&&this.fetch.setAuthToken(r.auth.token),this.realtime=new J(e,r?.auth?.token||null),this.storage=new I(this.fetch),this.functions=new K(this.fetch),this.jobs=new $(this.fetch),this.admin=new oe(this.fetch),this.management=new O(this.fetch),this.settings=new z(this.fetch);let n=e.startsWith("https")?"wss":"ws",a=e.replace(/^https?:/,n+":");this.ai=new ie(this.fetch,a),this.vector=new ue(this.fetch);let o=new V(this.fetch),l=async(c,u)=>{let f=await o.invoke(c,u);return{data:f.data?.result??null,error:f.error}};Object.assign(l,{invoke:o.invoke.bind(o),list:o.list.bind(o),getStatus:o.getStatus.bind(o),getLogs:o.getLogs.bind(o),waitForCompletion:o.waitForCompletion.bind(o)}),this.rpc=l,this.setupAuthSync()}from(e){return new T(this.fetch,e)}schema(e){return new le(this.fetch,e)}setupAuthSync(){let e=this.fetch.setAuthToken.bind(this.fetch);this.fetch.setAuthToken=t=>{e(t),this.realtime.setAuth(t)},this.realtime.setTokenRefreshCallback(async()=>{let t=await this.auth.refreshSession();return t.error||!t.data?.session?(console.error("[Fluxbase] Failed to refresh token for realtime:",t.error),null):t.data.session.access_token})}getAuthToken(){return this.auth.getAccessToken()}setAuthToken(e){this.fetch.setAuthToken(e),this.realtime.setAuth(e)}channel(e,t){return this.realtime.channel(e,t)}removeChannel(e){return this.realtime.removeChannel(e)}get http(){return this.fetch}};function A(i){if(typeof process<"u"&&process.env)return process.env[i];if(typeof Deno<"u"&&Deno?.env)return Deno.env.get(i)}function Pe(i,e,t){let r=i||A("FLUXBASE_URL")||A("NEXT_PUBLIC_FLUXBASE_URL")||A("VITE_FLUXBASE_URL"),s=e||A("FLUXBASE_ANON_KEY")||A("FLUXBASE_SERVICE_TOKEN")||A("FLUXBASE_JOB_TOKEN")||A("NEXT_PUBLIC_FLUXBASE_ANON_KEY")||A("VITE_FLUXBASE_ANON_KEY");if(!r)throw new Error("Fluxbase URL is required. Pass it as the first argument or set FLUXBASE_URL environment variable.");if(!s)throw new Error("Fluxbase key is required. Pass it as the second argument or set FLUXBASE_ANON_KEY environment variable.");return new B(r,s,t)}return Ie(Me);})();

// Create pre-configured client using environment variables
function _createFluxbaseClient(url, token, clientName) {
  if (!url || !token) {
    console.error('[Fluxbase SDK] ' + clientName + ': Missing URL or token');
    return null;
  }
  try {
    return _FluxbaseSDK.createClient(url, token);
  } catch (e) {
    console.error('[Fluxbase SDK] ' + clientName + ': Failed to create client:', e.message);
    return null;
  }
}

// Expose createClient globally for user code
const createClient = _FluxbaseSDK.createClient;
